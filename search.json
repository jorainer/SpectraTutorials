[{"path":"https://jorainer.github.io/SpectraTutorials/Abstract-EuroBioc2020.html","id":null,"dir":"","previous_headings":"","what":"Abstract","title":"Abstract","text":"Mass spectrometry (MS) data key technology modern proteomics metabolomics experiments. Due continuous improvements MS instrumentation, generated data can easily become large. Also, different additional resources MS data exist, spectra libraries databases, specific file formats sometimes support manipulations original data. Learning experiences r Biocpkg(\"MSnbase\") Bioconductor package developed novel infrastructure handle MS spectral data R, r Biocpkg(\"Spectra\") package. package implements clear separation user functionality code provide, store import mass spectrometry data. Different backends can hence used enable access data various data resources designed specifically large MS data sets. Data manipulations default directly applied data cached lazy processing queue allows analyses also read-data representations. workshop shows expandability new infrastructure enable seamless integration analysis MS data variety input formats illustrated simple matching experimental MS2 spectra public spectral database export data format commonly used exchange MS2 data.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/Abstract-EuroBioc2022.html","id":null,"dir":"","previous_headings":"","what":"Abstract","title":"Abstract","text":"Mass spectrometry (MS) data key technology modern proteomics metabolomics experiments. Due continuous improvements MS instrumentation, generated data can easily become large. Also, different additional resources MS data exist, spectra libraries databases, specific file formats sometimes support manipulations original data. Learning experiences r Biocpkg(\"MSnbase\") Bioconductor package developed novel infrastructure handle MS spectral data R, r Biocpkg(\"Spectra\") package. package implements clear separation user functionality code provide, store import mass spectrometry data. Different backends can hence used enable access data various data resources. Depending backend, data representations can memory, disk, local remote. Data manipulations default directly applied data cached lazy processing queue allows analyses also read-data representations. workshop shows new infrastructure can used integrate data variety different input sources simple example fragment (MS2) spectra experiment matched reference MS2 spectra public spectral library. Results finally exported format commonly used exchange MS2 data.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/Abstract-EuroBioc2023.html","id":null,"dir":"","previous_headings":"","what":"Spectra: an expandable infrastructure to handle mass spectrometry data","title":"Spectra: an expandable infrastructure to handle mass spectrometry data","text":"Mass spectrometry (MS) data key technology modern metabolomics proteomics experiments. Continuous improvements MS instrumentation, larger experiments new technological developments lead ever growing data sizes increased number available variables making standard -memory data handling processing difficult. Spectra package provides modern infrastructure MS data handling specifically designed enable extension additional data resources alternative data representations. can realized extending virtual MsBackend class related methods. Implementations MsBackend classes can tailored specific needs, low memory footprint, fast processing, remote data access, also support specific additional data types variables. Importantly, data processing Spectra objects independent backend use due lazy evaluation mechanism caches data manipulations internally. workshop discusses different available data representations MS data along properties, advantages performances. addition, Spectra’s concept lazy evaluation data manipulations presented, well simple caching mechanism data modifications. Finally, explains new MsBackend instances can implemented tested ensure compliance. Describe: - Concept backends. - Loading MS data. - Backends, -disk, -memory. - Using MsBackendSql store data. - Use MsBackendMassbankSql access data: parallel processing possible. - Different properties backends. - Lazy processing caching.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"abstract","dir":"Articles","previous_headings":"","what":"Abstract","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"Mass spectrometry (MS) data key technology modern metabolomics proteomics experiments. Continuous improvements MS instrumentation, larger experiments new technological developments lead ever growing data sizes increased number available variables making standard -memory data handling processing difficult. Spectra package provides modern infrastructure MS data handling specifically designed enable extension additional data resources alternative data representations. can realized extending virtual MsBackend class related methods. Implementations MsBackend classes can tailored specific needs, low memory footprint, fast processing, remote data access, also support specific additional data types variables. Importantly, data processing Spectra objects independent backend use due lazy evaluation mechanism caches data manipulations internally. workshop discusses different available data representations MS data along properties, advantages performances. addition, Spectra’s concept lazy evaluation data manipulations presented, well simple caching mechanism data modifications. Finally, explains new MsBackend instances can implemented tested ensure compliance.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"introduction","dir":"Articles","previous_headings":"","what":"Introduction","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"workshop/tutorial assumes readers familiar mass spectrometry data. See LC-MS/MS nutshell section Seamless Integration Mass Spectrometry Data Different Sources vignette package general introduction MS.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"pre-requisites","dir":"Articles","previous_headings":"Introduction","what":"Pre-requisites","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"Basic familiarity R Bioconductor. Basic understanding Mass Spectrometry (MS) data.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"installation","dir":"Articles","previous_headings":"Introduction","what":"Installation","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"Get docker image tutorial docker pull jorainer/spectra_tutorials:latest. Start docker using Enter http://localhost:8787 web browser log username rstudio password bioc. Open R-markdown file (vignettes/Spectra-backends.Rmd) RStudio server version web browser evaluate R code blocks.","code":"docker run \\     -e PASSWORD=bioc \\     -p 8787:8787 \\     jorainer/spectra_tutorials:latest"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"rbioconductor-packages-used","dir":"Articles","previous_headings":"Introduction","what":"R/Bioconductor packages used","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"Spectra MsBackendSql","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"workshop-goals-and-objectives","dir":"Articles","previous_headings":"Introduction","what":"Workshop goals and objectives","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"technical demonstration internals Spectra package design MS infrastructure. ’re demonstrating use cases analysis workflows .","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"learning-goals","dir":"Articles","previous_headings":"Introduction > Workshop goals and objectives","what":"Learning goals","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"Understand MS data handled Spectra. Understand differences properties different MsBackend implementations.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"learning-objectives","dir":"Articles","previous_headings":"Introduction > Workshop goals and objectives","what":"Learning objectives","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"Learn MS data handled Spectra. Understand data representations/backends fit purpose/use case. Insights internals Spectra MS infrastructure facilitate implementation backend(s).","code":""},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"the-spectra-package","dir":"Articles","previous_headings":"Workshop","what":"The Spectra package","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"Purpose: provide expandable, well tested user-friendly infrastructure mass spectrometry (MS) data. Design: separation code representing main user interface code provide, store read MS data. Spectra: separation user functionality data representation Spectra: main interface end user. MsBackend: defines data stored managed. user need care data stored. functionality can applied MS data, regardless data stored. enables specialized data storage/representation options: remote data, low memory footprint, high performance.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"creating-and-using-spectra-objects","dir":"Articles","previous_headings":"Workshop","what":"Creating and using Spectra objects","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"MS data consists duplets mass--charge (m/z) intensity values along potential additional information, MS level, retention time, polarity etc. simplest form, MS data consists thus two (aligned) numeric vectors m/z intensity values e.g. data.frame containing potential additional annotations MS spectrum. Spectra terminology, \"mz\" \"intensity\" called peak variables (provide information individual mass peaks), annotations spectra variables (usually single value per spectrum). define m/z intensity values mass spectrum well data.frame additional spectra variables. basic representation MS data R. obvious reasons however better store data single container keeping separate, unrelated, variables. thus create Spectra object MS data. Spectra objects can created Spectra constructor function accepts (among possibilities) data.frame full MS data input. row data.frame expected contain data one spectrum. therefore need add m/z intensity values list numerical vectors data frame. now created Spectra object representing toy MS data. Individual spectra variables can accessed either $ name spectra variable, one dedicated accessor functions. Also, provided spectra variables \"msLevel\" \"polarity\" input data frame, variables available default Spectra object. called core spectra variables can always extracted Spectra object, even defined (case missing values returned). Spectra variables available Spectra object can listed spectraVariables function: ’ve now got Spectra object representing single MS spectrum - , name class implies, actually designed represent data multiple mass spectra (possibly whole experiment). thus define data.frame, time 3 rows, create Spectra object . Also, define additional spectra variables providing name ID compounds MS2 (fragment) spectrum represents. Now Spectra object representing 3 mass spectra set spectra peak variables. Spectra organized linearly, .e., one . Thus, Spectra length 3 element one spectrum. Subsetting works R object: Spectra behaves similar data.frame elements (rows) individual spectra columns spectra (peaks) variables, can accessed $ operator. Similar data.frame can also add new spectra variables (columns) using $<-. full peaks data can extracted peaksData function, returns list two-dimensional arrays values peaks variables. list element represents peaks data one spectrum, stored e.g. matrix columns peaks variables rows respective values peak. number rows peak variable arrays depends number mass peaks spectrum. number can extracted either using lengths: next extract peaks data Spectra subset data second spectrum. Finally, can also visualize peaks data spectrum Spectra.  plots can obviously also created manually individual peaks data:  Experimental MS data generally (ideally) stored files mzML, mzXML CDF format. open file formats can read software. Bioconductor, mzR package allows read/write data /formats. Also Spectra allows represent data raw data files: create Spectra object experimental data two mzML files provided Bioconductor’s msdata package. thus access raw experimental MS data Spectra object. contrast first example , used Spectra constructor providing character vector file names specified source = MsBackendMzR(). thus already anticipate concept backends. source parameter configured Spectra use MsBackendMzR backend import represent MS data two mzML files. Like first example, can subset object access spectra variables. Note however Spectra object many spectra variables available (depending provided raw data files). can visualize data.","code":"#' Define simple MS data mz <- c(56.0494, 69.0447, 83.0603, 109.0395, 110.0712,         111.0551, 123.0429, 138.0662, 195.0876) int <- c(0.459, 2.585, 2.446, 0.508, 8.968, 0.524, 0.974, 100.0, 40.994)  sv <- data.frame(msLevel = 1L, polarity = 1L) library(Spectra)  #' wrap m/z and intensities into a list and add them to the data.frame sv$mz <- list(mz) sv$intensity <- list(int)  #' Create a `Spectra` object from the data. s <- Spectra(sv) s ## MSn data (Spectra) with 1 spectra in a MsBackendMemory backend: ##     msLevel     rtime scanIndex ##   <integer> <numeric> <integer> ## 1         1        NA        NA ##  ... 16 more variables/columns. #' Access the MS level spectra variable s$msLevel ## [1] 1 msLevel(s) ## [1] 1 #' List all available spectra variables spectraVariables(s) ##  [1] \"msLevel\"                 \"rtime\"                   ##  [3] \"acquisitionNum\"          \"scanIndex\"               ##  [5] \"dataStorage\"             \"dataOrigin\"              ##  [7] \"centroided\"              \"smoothed\"                ##  [9] \"polarity\"                \"precScanNum\"             ## [11] \"precursorMz\"             \"precursorIntensity\"      ## [13] \"precursorCharge\"         \"collisionEnergy\"         ## [15] \"isolationWindowLowerMz\"  \"isolationWindowTargetMz\" ## [17] \"isolationWindowUpperMz\" #' Extract the retention time spectra variable s$rtime ## [1] NA #' Define spectra variables for 3 MS spectra. sv <- data.frame(     msLevel = c(2L, 2L, 2L),     polarity = c(1L, 1L, 1L),     id = c(\"HMDB0000001\", \"HMDB0000001\", \"HMDB0001847\"),     name = c(\"1-Methylhistidine\", \"1-Methylhistidine\", \"Caffeine\"))  #' Assign m/z and intensity values. sv$mz <- list(     c(109.2, 124.2, 124.5, 170.16, 170.52),     c(83.1, 96.12, 97.14, 109.14, 124.08, 125.1, 170.16),     c(56.0494, 69.0447, 83.0603, 109.0395, 110.0712,       111.0551, 123.0429, 138.0662, 195.0876)) sv$intensity <- list(     c(3.407, 47.494, 3.094, 100.0, 13.240),     c(6.685, 4.381, 3.022, 16.708, 100.0, 4.565, 40.643),     c(0.459, 2.585, 2.446, 0.508, 8.968, 0.524, 0.974, 100.0, 40.994))  #' Create a Spectra from this data. s <- Spectra(sv) s ## MSn data (Spectra) with 3 spectra in a MsBackendMemory backend: ##     msLevel     rtime scanIndex ##   <integer> <numeric> <integer> ## 1         2        NA        NA ## 2         2        NA        NA ## 3         2        NA        NA ##  ... 18 more variables/columns. #' List available spectra and peaks variables. spectraVariables(s) ##  [1] \"msLevel\"                 \"rtime\"                   ##  [3] \"acquisitionNum\"          \"scanIndex\"               ##  [5] \"dataStorage\"             \"dataOrigin\"              ##  [7] \"centroided\"              \"smoothed\"                ##  [9] \"polarity\"                \"precScanNum\"             ## [11] \"precursorMz\"             \"precursorIntensity\"      ## [13] \"precursorCharge\"         \"collisionEnergy\"         ## [15] \"isolationWindowLowerMz\"  \"isolationWindowTargetMz\" ## [17] \"isolationWindowUpperMz\"  \"id\"                      ## [19] \"name\" peaksVariables(s) ## [1] \"mz\"        \"intensity\" length(s) ## [1] 3 #' Extract the 2nd spectrum s[2] ## MSn data (Spectra) with 1 spectra in a MsBackendMemory backend: ##     msLevel     rtime scanIndex ##   <integer> <numeric> <integer> ## 1         2        NA        NA ##  ... 18 more variables/columns. s$msLevel ## [1] 2 2 2 #' Add a new spectra variable. s$new_variable <- c(\"a\", \"b\", \"c\") spectraVariables(s) ##  [1] \"msLevel\"                 \"rtime\"                   ##  [3] \"acquisitionNum\"          \"scanIndex\"               ##  [5] \"dataStorage\"             \"dataOrigin\"              ##  [7] \"centroided\"              \"smoothed\"                ##  [9] \"polarity\"                \"precScanNum\"             ## [11] \"precursorMz\"             \"precursorIntensity\"      ## [13] \"precursorCharge\"         \"collisionEnergy\"         ## [15] \"isolationWindowLowerMz\"  \"isolationWindowTargetMz\" ## [17] \"isolationWindowUpperMz\"  \"id\"                      ## [19] \"name\"                    \"new_variable\" #' Get the number of peaks per spectrum. lengths(s) ## [1] 5 7 9 #' Extract the peaks matrix of the second spectrum peaksData(s)[[2]] ##          mz intensity ## [1,]  83.10     6.685 ## [2,]  96.12     4.381 ## [3,]  97.14     3.022 ## [4,] 109.14    16.708 ## [5,] 124.08   100.000 ## [6,] 125.10     4.565 ## [7,] 170.16    40.643 #' Plot the second spectrum. plotSpectra(s[2]) plot(mz(s)[[2]], intensity(s)[[2]], type = \"h\",      xlab = \"m/z\", ylab = \"intensity\") #' Import MS data from 2 mzML files. fls <- dir(system.file(\"sciex\", package = \"msdata\"), full.names = TRUE) s2 <- Spectra(fls, source = MsBackendMzR()) s2 ## MSn data (Spectra) with 1862 spectra in a MsBackendMzR backend: ##        msLevel     rtime scanIndex ##      <integer> <numeric> <integer> ## 1            1     0.280         1 ## 2            1     0.559         2 ## 3            1     0.838         3 ## 4            1     1.117         4 ## 5            1     1.396         5 ## ...        ...       ...       ... ## 1858         1   258.636       927 ## 1859         1   258.915       928 ## 1860         1   259.194       929 ## 1861         1   259.473       930 ## 1862         1   259.752       931 ##  ... 33 more variables/columns. ##  ## file(s): ## 20171016_POOL_POS_1_105-134.mzML ## 20171016_POOL_POS_3_105-134.mzML #' Available spectra variables spectraVariables(s2) ##  [1] \"msLevel\"                  \"rtime\"                    ##  [3] \"acquisitionNum\"           \"scanIndex\"                ##  [5] \"dataStorage\"              \"dataOrigin\"               ##  [7] \"centroided\"               \"smoothed\"                 ##  [9] \"polarity\"                 \"precScanNum\"              ## [11] \"precursorMz\"              \"precursorIntensity\"       ## [13] \"precursorCharge\"          \"collisionEnergy\"          ## [15] \"isolationWindowLowerMz\"   \"isolationWindowTargetMz\"  ## [17] \"isolationWindowUpperMz\"   \"peaksCount\"               ## [19] \"totIonCurrent\"            \"basePeakMZ\"               ## [21] \"basePeakIntensity\"        \"ionisationEnergy\"         ## [23] \"lowMZ\"                    \"highMZ\"                   ## [25] \"mergedScan\"               \"mergedResultScanNum\"      ## [27] \"mergedResultStartScanNum\" \"mergedResultEndScanNum\"   ## [29] \"injectionTime\"            \"filterString\"             ## [31] \"spectrumId\"               \"ionMobilityDriftTime\"     ## [33] \"scanWindowLowerLimit\"     \"scanWindowUpperLimit\" #' Access the MS levels for the first 6 spectra s2$msLevel |> head() ## [1] 1 1 1 1 1 1 #' Plot the 4th spectrum. plotSpectra(s2[4])"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"use-of-different-backends-with-spectra-why-and-how","dir":"Articles","previous_headings":"Workshop","what":"Use of different backends with Spectra, why and how?","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"Spectra objects behave way, .e. data can accessed way, actually use different backends thus data representations: first example Spectra uses MsBackendMemory backend , name tells, keeps MS data memory (within backend object). contrast, second Spectra represents experimental MS data two mzML files uses MsBackendMzR backend. backend loads general spectra data (variables) memory imports peaks data -demand original data files needed/requested (similar -disk mode discussed (Gatto, Gibb, Rainer 2020)). advantage offline storage mode lower memory footprint enables also analysis large data experiments standard computers. different backends? Reason 1: support additional file formats. backend class defines functionality import/export data /specific file formats. Spectra class stays data storage agnostic. Support additional file formats can implemented independently Spectra package can contributed different developers. Examples: MsBackendMgf (defined MsBackendMgf) adds support MS files MGF file format. MsBackendMsp (defined MsBackendMsp adds support MSP files. MsBackendRawFileReader (defined MsBackendRawFileReader) adds support MS data files Thermo Fisher Scientific’s raw data file format. import data files certain format, respective backend able handle data needs specified parameter source Spectra constructor call: Reason 2: support different implementations store represent data. includes data stored stored. Specialized backends can defined , example, optimized high performance low memory demand. Examples: MsBackendMemory (defined Spectra): keeps MS data memory optimized fast efficient access peaks data matrices (.e., m/z intensity values spectra). MsBackendMzR (defined Spectra): keeps spectra variables memory retrieves peaks data --fly original data files upon request. guarantees lower memory footprint enables also analysis large MS experiments. MsBackendSql (defined MsBackendSql package): MS data stored SQL database. minimal memory requirements data (whether spectra peaks variables) need retrieved database. Depending SQL database system used, backend also allow remote data access. evaluate illustrate properties different backends create Spectra objects data, using different backends. use setBackend function change backend Spectra object. call loaded MS data original data files memory. third option next store full MS data SQL database using/changing MsBackendOfflineSql backend defined MsBackendSql package. setBackend call need provide connection information database contain data. includes database driver (parameter drv, depending database system), database name (parameter dbname) well eventual additional connection information like host, username, port password. parameters required depends SQL database used hence driver (see also ?dbConnect information parameters). example store data SQLite database. thus set drv = SQLite() provide parameter dbname name SQLite database file (yet exist). addition, importantly, disable parallel processing BPPARAM = SerialParam() since SQL databases don’t support parallel data import. Note: efficient way import MS data data files SQL database createMsBackendSqlDatabase MsBackendSql package. Also, larger data sets suggested use advanced powerful SQL database systems (e.g. MySQL/MariaDB SQL databases). now 3 Spectra objects representing MS data, using different backends. first comparison evaluate size memory: expected, size Spectra object MsBackendMemory backend largest, two backends much lower, needing less 1MB total memory. Since MsBackendOfflineSql backend keeps primary keys spectra memory ’s memory requirements particularly small thus ideal represent even large MS experiments. next evaluate performance extract spectra variables. compare time needed extract retention times 3 Spectra object using microbenchmark function. Also disable potential parallel processing using register(SerialParam()). Highest performance can seen Spectra object MsBackendMemory backend, followed Spectra object MsBackendMzR backend, extraction spectra variables slowest Spectra MsBackendOfflineSql. next also evaluate performance extract peaks data, .e. individual m/z intensity values spectra two files. MsBackendMemory outperforms two backends also comparison. MsBackendMzR MsBackendOfflineSql need import data first memory, MsBackendMzR original mzML files MsBackendOfflineSql SQL database (present data efficient). last evaluate performance subset 3 Spectra objects 10 random spectra. , MsBackendOfflineSql clear advantage two backends, needs simply subset integer vector primary keys, MsBackendMemory needs subset full data, MsBackendMzR data frame spectra variables.","code":"class(s@backend) ## [1] \"MsBackendMemory\" ## attr(,\"package\") ## [1] \"Spectra\" class(s2@backend) ## [1] \"MsBackendMzR\" ## attr(,\"package\") ## [1] \"Spectra\" #' Import MS data from mzML files s_mzr <- Spectra(fls, source = MsBackendMzR()) #' Change the backend to MsBackendMemory s_mem <- setBackend(s_mzr, MsBackendMemory()) #' Change the backend to a SQL representation of the data. library(MsBackendSql) ## Warning: multiple methods tables found for 'uniqueMsLevels' library(RSQLite) s_db <- setBackend(s_mzr, MsBackendOfflineSql(), drv = SQLite(),                    dbname = \"ms_backend_sql_test.sqlite\",                    BPPARAM = SerialParam()) #' Compare memory footprint. print(object.size(s_mem), units = \"MB\") ## 53.2 Mb print(object.size(s_mzr), units = \"MB\") ## 0.4 Mb print(object.size(s_db), units = \"MB\") ## 0.1 Mb #' Compare performance to extract the retention times. register(SerialParam()) library(microbenchmark) microbenchmark(     rtime(s_mem),     rtime(s_mzr),     rtime(s_db),     times = 13 ) ## Unit: microseconds ##          expr     min      lq        mean  median      uq     max neval ##  rtime(s_mem)    16.4    34.8    41.47692    44.7    47.4    84.9    13 ##  rtime(s_mzr)   617.4   631.9   679.16154   650.4   663.6  1079.4    13 ##   rtime(s_db) 10858.6 10902.2 13212.31538 10985.5 11218.3 38839.9    13 #' Compare performance to extract the peaks data. microbenchmark(     peaksData(s_mem),     peaksData(s_mzr),     peaksData(s_db),     times = 7 ) ## Unit: milliseconds ##              expr      min        lq       mean   median       uq      max ##  peaksData(s_mem)   1.1357   1.33685   1.391643   1.3746   1.3971   1.7633 ##  peaksData(s_mzr) 685.8911 687.61770 694.940600 691.3863 701.1987 709.6741 ##   peaksData(s_db) 160.6382 163.87690 356.048900 419.6727 439.9720 704.3336 ##  neval ##      7 ##      7 ##      7 #' Compare performance to subset the Spectra. idx <- sample(seq_along(s_mem), 10) microbenchmark(     s_mem[idx],     s_mzr[idx],     s_db[idx] ) ## Unit: microseconds ##        expr   min     lq     mean  median      uq    max neval ##  s_mem[idx] 279.3 312.75  338.391  336.95  360.80  486.2   100 ##  s_mzr[idx] 949.8 976.90 1016.561 1003.40 1038.20 1794.5   100 ##   s_db[idx] 179.0 206.00  252.300  246.90  255.45 1974.6   100"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"performance-considerations-and-tweaks","dir":"Articles","previous_headings":"Workshop > Use of different backends with Spectra, why and how?","what":"Performance considerations and tweaks","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"Keeping data memory (e.g. using MsBackendMemory) obvious performance advantages, might possible MS experiments. -disk backends MsBackendMzR MsBackendOfflineSql allow, due lower memory footprint, analyze also large data sets. optimized build-option Spectra methods load process MS data small chunks contrast loading processing full data whole. performance offline backends MsBackendMzR MsBackendSql/MsBackendOfflineSql depend also /O capabilities hard disks containing data files well , latter, configuration SQL database system used.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"data-manipulation-and-the-lazy-evaluation-queue","dir":"Articles","previous_headings":"Workshop","what":"Data manipulation and the lazy evaluation queue","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"data representations might, design way data handled stored, allow changing existing adding new values. MsBackendMzR backend example retrieves peaks data directly raw data files don’t want manipulation m/z intensity values directly written back original data files. Also backends, specifically provide access spectral reference databases (MsBackendMassbankSql MsBackendMassbank package MsBackendCompDb CompoundDb package), supposed allow data changes written back databases. Data manipulations however integrative part data analysis thus need backends mechanism allows changes data without propagating original data resource. backend classes use dediacted caching mechanisms enable adding, changing, deleting spectra variables. illustrate implemented 3 backend classes add new spectra variable \"new_variable\" 3 Spectra objects. new spectra variable now added 3 Spectra objects: MsBackendMemory stores spectra variables data.frame within object. new spectra variable thus simply added new column data.frame. Warning: NEVER access manipulate slots backend class directly like can easily result data corruption. Similarly, also MsBackendMzR stores data spectra variables (peaks variables!) within DataFrame. Adding new spectra variable thus also added new column DataFrame. Note: use DataFrame instead data.frame MsBackendMzR explains performance differences subset access spectra variables ’ve seen backend MsBackendMemory . Finally, also MsBackendOfflineSql backend, new spectra variable cached within dedicated data.frame inside object. side effect, can also used MsBackendOfflineSql backends cache spectra variables memory faster access. Note: base MsBackendCached class defined Spectra package provides caching mechanism spectra variables MsBackendOfflineSql backend . Thus, MsBackend implementation extending base class automatically inherit mechanism need implement . Examples backends extending MsBackendCached , among others, MsBackendSql, MsBackendOfflineSql, MsBackendMassbankSql. Analysis MS data requires, addition changing adding spectra variables also possibility manipulate peaks data (.e. m/z intensity values individual mass peaks spectra). simple example remove mass peaks intensity 100 data set compare number peaks per spectra operation.  operation reduce number peaks considerably. repeat operation now also two backends. number peaks also reduced two backends although keep peak data memory , discussed , allow changes data file (database) containing original data. Due (generally) limited manageable size, caching mechanisms described work well efficiently spectra variables. MS peaks data (m/z intensity values individual peaks MS spectra) however represent much larger data volumes. Thus, -memory caching changes peaks data generally possible types MS data. reason caching changes values within objects, actual data manipulation operation . done automatically Spectra object (MsBackend!) (peaks) data manipulation functions. Internally, stored lazy processing queue. time peaks data accessed (like intensity call example ), Spectra object first request raw peaks data backend, check processing queue , empty, apply contained cached processing steps peaks data returning user. nice side effect, subset data accessed, data manipulations need applied requested data subset, full data. can positive impact overall performance: lazy processing mechanism implemented Spectra object thus independent backend used represent data. Thus, allows apply also data manipulations MS data data resources inherently read-(e.g. reference libraries fragment spectra). addition, since changing peaks data, can also undo data manipulations. simple reset call Spectra object restore data object initial state (fact simply clears processing queue). TODO: explain addProcessing","code":"#' Assign new spectra variables. s_mem$new_variable <- seq_along(s_mem) s_mzr$new_variable <- seq_along(s_mem) s_db$new_variable <- seq_along(s_mem) #' Show spectra variables for one of the Spectra spectraVariables(s_mzr) ##  [1] \"msLevel\"                  \"rtime\"                    ##  [3] \"acquisitionNum\"           \"scanIndex\"                ##  [5] \"dataStorage\"              \"dataOrigin\"               ##  [7] \"centroided\"               \"smoothed\"                 ##  [9] \"polarity\"                 \"precScanNum\"              ## [11] \"precursorMz\"              \"precursorIntensity\"       ## [13] \"precursorCharge\"          \"collisionEnergy\"          ## [15] \"isolationWindowLowerMz\"   \"isolationWindowTargetMz\"  ## [17] \"isolationWindowUpperMz\"   \"peaksCount\"               ## [19] \"totIonCurrent\"            \"basePeakMZ\"               ## [21] \"basePeakIntensity\"        \"ionisationEnergy\"         ## [23] \"lowMZ\"                    \"highMZ\"                   ## [25] \"mergedScan\"               \"mergedResultScanNum\"      ## [27] \"mergedResultStartScanNum\" \"mergedResultEndScanNum\"   ## [29] \"injectionTime\"            \"filterString\"             ## [31] \"spectrumId\"               \"ionMobilityDriftTime\"     ## [33] \"scanWindowLowerLimit\"     \"scanWindowUpperLimit\"     ## [35] \"new_variable\" #' Direct access to the backend's data. s_mem@backend@spectraData |> head() ##   msLevel rtime acquisitionNum scanIndex dataStorage ## 1       1 0.280              1         1    <memory> ## 2       1 0.559              2         2    <memory> ## 3       1 0.838              3         3    <memory> ## 4       1 1.117              4         4    <memory> ## 5       1 1.396              5         5    <memory> ## 6       1 1.675              6         6    <memory> ##                                                                    dataOrigin ## 1 /usr/local/lib/R/site-library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML ## 2 /usr/local/lib/R/site-library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML ## 3 /usr/local/lib/R/site-library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML ## 4 /usr/local/lib/R/site-library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML ## 5 /usr/local/lib/R/site-library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML ## 6 /usr/local/lib/R/site-library/msdata/sciex/20171016_POOL_POS_1_105-134.mzML ##   centroided smoothed polarity precScanNum precursorMz precursorIntensity ## 1      FALSE       NA        1          NA          NA                 NA ## 2      FALSE       NA        1          NA          NA                 NA ## 3      FALSE       NA        1          NA          NA                 NA ## 4      FALSE       NA        1          NA          NA                 NA ## 5      FALSE       NA        1          NA          NA                 NA ## 6      FALSE       NA        1          NA          NA                 NA ##   precursorCharge collisionEnergy isolationWindowLowerMz ## 1              NA              NA                     NA ## 2              NA              NA                     NA ## 3              NA              NA                     NA ## 4              NA              NA                     NA ## 5              NA              NA                     NA ## 6              NA              NA                     NA ##   isolationWindowTargetMz isolationWindowUpperMz peaksCount totIonCurrent ## 1                      NA                     NA        578        898185 ## 2                      NA                     NA       1529       1037012 ## 3                      NA                     NA       1600       1094971 ## 4                      NA                     NA       1664       1135015 ## 5                      NA                     NA       1417       1106233 ## 6                      NA                     NA       1602       1181489 ##   basePeakMZ basePeakIntensity ionisationEnergy    lowMZ   highMZ mergedScan ## 1   124.0860            154089                0 105.0435 133.9837         NA ## 2   124.0859            182690                0 105.0275 133.9836         NA ## 3   124.0859            196650                0 105.0376 133.9902         NA ## 4   124.0859            203502                0 105.0376 133.9853         NA ## 5   124.0859            191715                0 105.0347 133.9885         NA ## 6   124.0859            213400                0 105.0420 133.9836         NA ##   mergedResultScanNum mergedResultStartScanNum mergedResultEndScanNum ## 1                  NA                       NA                     NA ## 2                  NA                       NA                     NA ## 3                  NA                       NA                     NA ## 4                  NA                       NA                     NA ## 5                  NA                       NA                     NA ## 6                  NA                       NA                     NA ##   injectionTime filterString                             spectrumId ## 1             0         <NA> sample=1 period=1 cycle=1 experiment=1 ## 2             0         <NA> sample=1 period=1 cycle=2 experiment=1 ## 3             0         <NA> sample=1 period=1 cycle=3 experiment=1 ## 4             0         <NA> sample=1 period=1 cycle=4 experiment=1 ## 5             0         <NA> sample=1 period=1 cycle=5 experiment=1 ## 6             0         <NA> sample=1 period=1 cycle=6 experiment=1 ##   ionMobilityDriftTime scanWindowLowerLimit scanWindowUpperLimit new_variable ## 1                   NA                   NA                   NA            1 ## 2                   NA                   NA                   NA            2 ## 3                   NA                   NA                   NA            3 ## 4                   NA                   NA                   NA            4 ## 5                   NA                   NA                   NA            5 ## 6                   NA                   NA                   NA            6 s_mzr@backend@spectraData ## DataFrame with 1862 rows and 26 columns ##      scanIndex acquisitionNum   msLevel  polarity peaksCount totIonCurrent ##      <integer>      <integer> <integer> <integer>  <integer>     <numeric> ## 1            1              1         1         1        578        898185 ## 2            2              2         1         1       1529       1037012 ## 3            3              3         1         1       1600       1094971 ## 4            4              4         1         1       1664       1135015 ## 5            5              5         1         1       1417       1106233 ## ...        ...            ...       ...       ...        ...           ... ## 1858       927            927         1         1       3528        418159 ## 1859       928            928         1         1       3662        429930 ## 1860       929            929         1         1       3442        413427 ## 1861       930            930         1         1       3564        447033 ## 1862       931            931         1         1       3517        441025 ##          rtime basePeakMZ basePeakIntensity ionisationEnergy     lowMZ ##      <numeric>  <numeric>         <numeric>        <numeric> <numeric> ## 1        0.280    124.086            154089                0   105.043 ## 2        0.559    124.086            182690                0   105.028 ## 3        0.838    124.086            196650                0   105.038 ## 4        1.117    124.086            203502                0   105.038 ## 5        1.396    124.086            191715                0   105.035 ## ...        ...        ...               ...              ...       ... ## 1858   258.636    123.090             28544                0   105.008 ## 1859   258.915    123.090             29164                0   105.009 ## 1860   259.194    123.090             28724                0   105.010 ## 1861   259.473    123.091             28743                0   105.012 ## 1862   259.752    123.091             27503                0   105.012 ##         highMZ mergedScan mergedResultScanNum mergedResultStartScanNum ##      <numeric>  <integer>           <integer>                <integer> ## 1      133.984         NA                  NA                       NA ## 2      133.984         NA                  NA                       NA ## 3      133.990         NA                  NA                       NA ## 4      133.985         NA                  NA                       NA ## 5      133.989         NA                  NA                       NA ## ...        ...        ...                 ...                      ... ## 1858   134.000         NA                  NA                       NA ## 1859   134.000         NA                  NA                       NA ## 1860   134.000         NA                  NA                       NA ## 1861   133.998         NA                  NA                       NA ## 1862   133.997         NA                  NA                       NA ##      mergedResultEndScanNum injectionTime filterString             spectrumId ##                   <integer>     <numeric>  <character>            <character> ## 1                        NA             0           NA sample=1 period=1 cy.. ## 2                        NA             0           NA sample=1 period=1 cy.. ## 3                        NA             0           NA sample=1 period=1 cy.. ## 4                        NA             0           NA sample=1 period=1 cy.. ## 5                        NA             0           NA sample=1 period=1 cy.. ## ...                     ...           ...          ...                    ... ## 1858                     NA             0           NA sample=1 period=1 cy.. ## 1859                     NA             0           NA sample=1 period=1 cy.. ## 1860                     NA             0           NA sample=1 period=1 cy.. ## 1861                     NA             0           NA sample=1 period=1 cy.. ## 1862                     NA             0           NA sample=1 period=1 cy.. ##      centroided ionMobilityDriftTime scanWindowLowerLimit scanWindowUpperLimit ##       <logical>            <numeric>            <numeric>            <numeric> ## 1         FALSE                   NA                   NA                   NA ## 2         FALSE                   NA                   NA                   NA ## 3         FALSE                   NA                   NA                   NA ## 4         FALSE                   NA                   NA                   NA ## 5         FALSE                   NA                   NA                   NA ## ...         ...                  ...                  ...                  ... ## 1858      FALSE                   NA                   NA                   NA ## 1859      FALSE                   NA                   NA                   NA ## 1860      FALSE                   NA                   NA                   NA ## 1861      FALSE                   NA                   NA                   NA ## 1862      FALSE                   NA                   NA                   NA ##                 dataStorage             dataOrigin new_variable ##                 <character>            <character>    <integer> ## 1    /usr/local/lib/R/sit.. /usr/local/lib/R/sit..            1 ## 2    /usr/local/lib/R/sit.. /usr/local/lib/R/sit..            2 ## 3    /usr/local/lib/R/sit.. /usr/local/lib/R/sit..            3 ## 4    /usr/local/lib/R/sit.. /usr/local/lib/R/sit..            4 ## 5    /usr/local/lib/R/sit.. /usr/local/lib/R/sit..            5 ## ...                     ...                    ...          ... ## 1858 /usr/local/lib/R/sit.. /usr/local/lib/R/sit..         1858 ## 1859 /usr/local/lib/R/sit.. /usr/local/lib/R/sit..         1859 ## 1860 /usr/local/lib/R/sit.. /usr/local/lib/R/sit..         1860 ## 1861 /usr/local/lib/R/sit.. /usr/local/lib/R/sit..         1861 ## 1862 /usr/local/lib/R/sit.. /usr/local/lib/R/sit..         1862 s_db@backend@localData |> head() ##   new_variable ## 1            1 ## 2            2 ## 3            3 ## 4            4 ## 5            5 ## 6            6 s_db2 <- s_db  #' Cache an existing spectra variable in memory s_db2$rtime <- rtime(s_db2)  microbenchmark(     rtime(s_db),     rtime(s_db2),     times = 17 ) ## Unit: milliseconds ##          expr     min      lq      mean  median      uq     max neval ##   rtime(s_db) 10.9304 11.4421 11.700724 11.6603 12.1052 12.3710    17 ##  rtime(s_db2)  4.4253  4.7664  4.969771  4.8592  5.0550  6.0726    17 #' Remove all peaks with an intensity below 100 s_mem <- filterIntensity(s_mem, intensity = 100)  #' Compare the number of peaks before/after boxplot(list(before = lengths(s_mzr), after = lengths(s_mem)),         ylab = \"number of peaks\") #' Repeast filtering for the two other Spectra objects. s_mzr <- filterIntensity(s_mzr, intensity = 100) s_db <- filterIntensity(s_db, intensity = 100) #' Evaluate that subsetting worked for all. median(lengths(s_mem)) ## [1] 433 median(lengths(s_mzr)) ## [1] 433 median(lengths(s_db)) ## [1] 433 #' Show the processing queue. s_db@processingQueue ## [[1]] ## Object of class \"ProcessingStep\" ##  Function: user-provided function ##  Arguments: ##   o intensity = 100Inf ##   o msLevel = 1 #' Access intensity values and extract those of the 1st spectrum. intensity(s_db)[[1L]] ##   [1]    412    412    412    412    412    412    412    412    412   1237 ##  [11]    412    412    412    412    412    412    412    412    412    412 ##  [21]    412    412    824    412    412    412    412    412    412    412 ##  [31]    412    412    412    412    412    412   1237    412    412    412 ##  [41]    412    412    412    412    412    412    412    412    412    412 ##  [51]    824    412    412    412    412    412    412    412    824   1649 ##  [61]   2061   1237    412    412    412    412    412    412   2061   7008 ##  [71]  17727  22674  23910  12780   6184   3710   2061   1237    412    412 ##  [81]    412   1662    412   1258    861    854    845    873    842    412 ##  [91]    860   1307    882    442  12347  55349 132662 154089 115667  76817 ## [101]  41233  26904  11577   6155   2650   3966    872    461    461    433 ## [111]    412    442    430    461    412    412    412    412    412    426 ## [121]    449    412    412    824    412    412    433    412    412    412 ## [131]    412    412   1684    412    412    412   1649   1649   2061   1649 ## [141]   4947   6184   9482  10718   5359   2886   1649   1649   1237    412 ## [151]    412    412    412    412    412    412    412    412    412    412 ## [161]    412    412    412    412    412    412    412    412    412    412 ## [171]    412    412    412    412    412    412    412    412    412    412 ## [181]    412    412    412    412    412    412    412    412    412    412 ## [191]    412    412    412    412    824    412    412    412    412    412 ## [201]    412    412    412    412    412    412    412    824    412    412 ## [211]    412    412    412    412    412    412    412    412    412    412 ## [221]    412    824    824   1237   1649    824    412    412    412    412 ## [231]    824    412    824   1237    412    412    412    412    412    412 ## [241]    412    412    412    412    412    412    412 #' Compare extraction of intensity values. microbenchmark(     intensity(s_db[1:10]),     intensity(s_db)[1:10],     times = 7) ## Unit: milliseconds ##                   expr      min        lq      mean   median        uq      max ##  intensity(s_db[1:10])  15.4686  15.49205  16.62333  17.3066  17.42805  17.7479 ##  intensity(s_db)[1:10] 318.7602 328.11095 472.99930 561.9605 590.38970 593.2731 ##  neval ##      7 ##      7 #' Restore the Spectra object to its initial state. s_db <- reset(s_db) median(lengths(s_db)) ## [1] 1547"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"implementing-your-own-msbackend","dir":"Articles","previous_headings":"Workshop","what":"Implementing your own MsBackend","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"New backends Spectra extend MsBackend class implement methods defined infrastructure. Extending classes, MsBackendMemory MsBackendCached can help reducing number methods concepts needed implement. detailed example description provided Creating new MsBackend classes vignette - otherwise: open issue Spectra github repo. Add following code testthat.R file ensure compliance MsBackend definition:","code":"test_suite <- system.file(\"test_backends\", \"test_MsBackend\",                         package = \"Spectra\")  #' Assign an instance of the developed `MsBackend` to variable `be`. be <- my_be test_dir(test_suite, stop_on_failure = TRUE)"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-backends.html","id":"final-words","dir":"Articles","previous_headings":"Workshop","what":"Final words","title":"*Spectra*: an expandable infrastructure to handle mass spectrometry data","text":"designed support large data sets. easily extendable. support variety MS data file formats data representations.","code":""},{"path":[]},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-matching-with-MetaboAnnotation.html","id":"introduction","dir":"Articles","previous_headings":"Overview","what":"Introduction","title":"MS/MS Spectra Matching with the `MetaboAnnotation` Package","text":"Spectra package provides functionality required annotation identification workflows untargeted LC-MS/MS data, , flexible customizable, might cumbersome beginners analysts accustomed R. fill gap developed MetaboAnnotation package builds upon Spectra provides functions annotation LC-MS LC-MS/MS data sets tailored towards less experienced R user (Rainer et al. 2022).","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-matching-with-MetaboAnnotation.html","id":"convenient-spectra-matching-using-metaboannotation","dir":"Articles","previous_headings":"Overview","what":"Convenient spectra matching using MetaboAnnotation","title":"MS/MS Spectra Matching with the `MetaboAnnotation` Package","text":"example use case match experimental MS2 spectra DDA experiment pesticide mix reference spectra MassBank. load experimental data file distributed via msdata R package. next restrict data set MS2 spectra addition clean spectra removing peaks spectrum intensity lower 5% largest peak intensity spectrum. Finally, single-peak spectra removed. leads data set consisting 2451 spectra. next connect MassBank database (running within docker image) create Spectra object representing data. Alternatively, MySQL database system available tutorial can run within docker, SQLite database version MassBank data (format required MsBackendMassbankSql available . downloading database MassbankSql-2021-03.db current R workspace, resource can loaded : now directly calculate similarities 2451 experimental (query) MS2 spectra 86576 MassBank reference (target) spectra using compareSpectra method, computationally intense similarity score calculated query target spectrum. alternative use matchSpectra function MetaboAnnotation package allows restrict similarity calculations query target spectra similar m/z precursor ion similar retention time. create CompareSpectraParam object setting parameter requirePrecursor = TRUE (restrict similarity calculations query target spectra similar precursor m/z) ppm = 10 (m/z difference query target precursor within 10 ppm). Parameter THRESHFUN enables define threshold function defines spectra considered matching. function used MS2 spectra similarity (calculated default dotproduct function) larger equal 0.8 considered matching. next call matchSpectra parameter object pass pest mbank query target Spectra, respectively. takes approximately 1 minute complete, tremendously fast, still much faster pairwise comparison query target spectra . result get MatchedSpectra object contains query target spectra well matching result (.e. information query spectrum matches target spectrum based similarity score). can use query target functions access query target Spectra objects matches extract matching information. display first 6 rows matrix. Functions whichQuery whichTarget return (unique) indices query target spectra matched. can see query spectra (29 2451 spectra) matched. part large proportion spectra MassBank precursor m/z available requirePrecursor = TRUE considered similarity calculation. Setting requirePrecursor = FALSE calculate similarity spectra (even missing precursor information) calculations can take several hours. MatchedSpectra object inherits much functionality Spectra object. spectraVariables returns example available spectra variables, query well target Spectra. variable names latter prefixed target_ discriminate variable names query. can access spectra individual variables using $ variable name, multiple variables spectraData function. extract retention time, precursor m/z query spectrum, precursor m/z target spectrum well similarity score object using spectraData function. returned DataFrame contains matching information full data set, .e. query spectrum hence, returns NA values query spectra matched target spectrum. Note also query spectra matching multiple target spectra represented multiple rows (one matching target spectrum). ’re interested query spectra match found thus subset MatchedSpectra query spectra matching target spectrum. Subsetting MatchedSpectra always relative query, .e. subsetting object index 4 restrict object matching results 4th query spectrum. now extract matching information subsetting: can also return compound names matching spectra. matchSpectra enables thus perform convenient spectra matching MS data represented Spectra objects. result, MatchedSpectra object returned , addition matching results, contains also query target spectra. Pre-filtering spectra prior actual spectra similarity calculation can reduce running time matchSpectra call might also miss potential matches. Note addition precursor m/z-based pre-filter also retention time pre-filtering available (see ?matchSpectra information). Also, advanced matching approach available MatchForwardReverseParam calculates addition forward score also reverse similarity match.","code":"library(Spectra) library(pander)  #' Load the pesticide mix data fl <- system.file(\"TripleTOF-SWATH\", \"PestMix1_DDA.mzML\", package = \"msdata\") pest <- Spectra(fl) #' restrict to MS2 data and remove intensities with intensity lower 5% pest <- filterMsLevel(pest, msLevel = 2L)  #' Remove peaks with an intensity below 5% or the spectra's BPC low_int <- function(x, ...) {     x > max(x, na.rm = TRUE) * 0.05 } pest <- filterIntensity(pest, intensity = low_int)  #' Remove peaks with a single peak pest <- pest[lengths(pest) > 1] library(RMariaDB) library(MsBackendMassbank)  #' Connect to the MassBank MySQL database con <- dbConnect(MariaDB(), user = \"massbank\", dbname = \"MassBank\",                  host = \"localhost\", pass = \"massbank\") mbank <- Spectra(con, source = MsBackendMassbankSql()) ## Alternative to the MySQL server - assuming the SQLite database was ## stored to the R working directory. library(RSQLite) library(MsBackendMassbank) con <- dbConnect(SQLite(), \"MassbankSql-2021-03.db\") mbank <- Spectra(con, source = MsBackendMassbankSql()) library(MetaboAnnotation) prm <- CompareSpectraParam(ppm = 10, requirePrecursor = TRUE,                            THRESHFUN = function(x) which(x >= 0.8)) mtch <- matchSpectra(pest, mbank, param = prm) mtch ## Object of class MatchedSpectra  ## Total number of matches: 78  ## Number of query objects: 2451 (29 matched) ## Number of target objects: 86576 (47 matched) head(matches(mtch)) ##   query_idx target_idx     score ## 1       163      31941 0.9264249 ## 2       163      32022 0.9264249 ## 3       163      32214 0.9264249 ## 4       163      32508 0.9264249 ## 5       163      32667 0.9264249 ## 6       163      32900 0.9264249 whichQuery(mtch) ##  [1]  163  320  420  433  493  496  497  571  682  685  686  805  806  809  810 ## [16]  819  829  983 1095 1454 1457 1706 1830 1834 1839 1906 2047 2048 2050 sum(is.na(precursorMz(mbank))) ## [1] 24498 spectraVariables(mtch) ##  [1] \"msLevel\"                        \"rtime\"                          ##  [3] \"acquisitionNum\"                 \"scanIndex\"                      ##  [5] \"dataStorage\"                    \"dataOrigin\"                     ##  [7] \"centroided\"                     \"smoothed\"                       ##  [9] \"polarity\"                       \"precScanNum\"                    ## [11] \"precursorMz\"                    \"precursorIntensity\"             ## [13] \"precursorCharge\"                \"collisionEnergy\"                ## [15] \"isolationWindowLowerMz\"         \"isolationWindowTargetMz\"        ## [17] \"isolationWindowUpperMz\"         \"peaksCount\"                     ## [19] \"totIonCurrent\"                  \"basePeakMZ\"                     ## [21] \"basePeakIntensity\"              \"ionisationEnergy\"               ## [23] \"lowMZ\"                          \"highMZ\"                         ## [25] \"mergedScan\"                     \"mergedResultScanNum\"            ## [27] \"mergedResultStartScanNum\"       \"mergedResultEndScanNum\"         ## [29] \"injectionTime\"                  \"filterString\"                   ## [31] \"spectrumId\"                     \"ionMobilityDriftTime\"           ## [33] \"scanWindowLowerLimit\"           \"scanWindowUpperLimit\"           ## [35] \"target_msLevel\"                 \"target_rtime\"                   ## [37] \"target_acquisitionNum\"          \"target_scanIndex\"               ## [39] \"target_dataStorage\"             \"target_dataOrigin\"              ## [41] \"target_centroided\"              \"target_smoothed\"                ## [43] \"target_polarity\"                \"target_precScanNum\"             ## [45] \"target_precursorMz\"             \"target_precursorIntensity\"      ## [47] \"target_precursorCharge\"         \"target_collisionEnergy\"         ## [49] \"target_isolationWindowLowerMz\"  \"target_isolationWindowTargetMz\" ## [51] \"target_isolationWindowUpperMz\"  \"target_spectrum_id\"             ## [53] \"target_spectrum_name\"           \"target_date\"                    ## [55] \"target_authors\"                 \"target_license\"                 ## [57] \"target_copyright\"               \"target_publication\"             ## [59] \"target_splash\"                  \"target_compound_id\"             ## [61] \"target_adduct\"                  \"target_ionization\"              ## [63] \"target_ionization_voltage\"      \"target_fragmentation_mode\"      ## [65] \"target_collision_energy_text\"   \"target_instrument\"              ## [67] \"target_instrument_type\"         \"target_formula\"                 ## [69] \"target_exactmass\"               \"target_smiles\"                  ## [71] \"target_inchi\"                   \"target_inchikey\"                ## [73] \"target_cas\"                     \"target_pubchem\"                 ## [75] \"target_synonym\"                 \"target_precursor_mz_text\"       ## [77] \"target_compound_name\"           \"score\" spectraData(mtch, c(\"rtime\", \"precursorMz\", \"target_precursorMz\", \"score\")) ## DataFrame with 2500 rows and 4 columns ##          rtime precursorMz target_precursorMz     score ##      <numeric>   <numeric>          <numeric> <numeric> ## 1        7.216    137.9639                 NA        NA ## 2       13.146     56.9419                 NA        NA ## 3       13.556     89.9449                 NA        NA ## 4       23.085    207.0294                 NA        NA ## 5       27.385    121.0990                 NA        NA ## ...        ...         ...                ...       ... ## 2496   895.182    137.9850                 NA        NA ## 2497   895.472     56.0495                 NA        NA ## 2498   896.252    142.9611                 NA        NA ## 2499   896.662     53.0129                 NA        NA ## 2500   898.602     91.5022                 NA        NA mtch <- mtch[whichQuery(mtch)] spectraData(mtch, c(\"rtime\", \"precursorMz\", \"target_precursorMz\", \"score\")) ## DataFrame with 78 rows and 4 columns ##         rtime precursorMz target_precursorMz     score ##     <numeric>   <numeric>          <numeric> <numeric> ## 1     173.184     305.156            305.157  0.926425 ## 2     173.184     305.156            305.157  0.926425 ## 3     173.184     305.156            305.157  0.926425 ## 4     173.184     305.156            305.157  0.926425 ## 5     173.184     305.156            305.157  0.926425 ## ...       ...         ...                ...       ... ## 74    527.419     279.156            279.159  0.814331 ## 75    527.419     279.156            279.159  0.822396 ## 76    570.096     373.039            373.041  0.934031 ## 77    570.506     373.042            373.041  0.888829 ## 78    570.825     373.040            373.041  0.827892 pandoc.table(style = \"rmarkdown\",     as.data.frame(spectraData(mtch, c(\"rtime\", \"target_compound_name\",                                       \"score\"))))"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-matching-with-MetaboAnnotation.html","id":"ms2-spectra-matching-in-an-xcms-workflow","dir":"Articles","previous_headings":"Overview","what":"MS2 spectra matching in an xcms workflow","title":"MS/MS Spectra Matching with the `MetaboAnnotation` Package","text":"LC-MS/MS-based untargeted metabolomics (small compound mass spectrometry experiments general) quantification compounds performed MS1 MS2 data used identification features. Quantification MS1 data requires chromatographic peak detection step can performed using functionality xcms package. load thus xcms package import full MS data using readMSData function. next perform chromatographic peak detection using centWave algorithm (see LC-MS/MS data analysis xcms vignette xcms package details chromatographic peak detection settings). total 99 chromatographic peaks identified. display first 6 . can now extract MS2 spectra chromatographic peak chromPeakSpectra function. function identifies MS2 spectra recorded instrument retention time within retention time precursor m/z within m/z boundaries chromatographic peak. setting return.type = \"Spectra\" ensure data returned newer Spectra format hence enabling simplified spectra matching functionality presented . Spectra variable peak_id contains identified chromatographic peak (.e. row name chromPeaks). next, like previous section, clean spectra removing peaks intensity 5% largest peak intensity per spectrum removing spectra single peak. addition scale also intensities within MS2 spectrum replacing intensities relative maximum peak intensity (see information). addition query spectra, also normalize MassBank spectra way. Next perform now spectra matching parameters previous section. , restrict MatchedSpectra query spectra matched. table lists compound names matching spectra chromatographic peaks. can also directly plot matching (query target) spectra using plotSpectraMirror function subsetting MatchedSpectra object query spectrum interest. plot third query spectrum matching target spectra.  Summarizing, chromPeakSpectra featureSpectra functions, xcms allows return MS data Spectra objects enables, shown simple example, perform MS2 spectra matching using Spectra well MetaboAnnotation packages hence simplifying MS/MS-based annotation LC-MS features xcms.","code":"library(xcms) pest_all <- readMSData(fl, mode = \"onDisk\") cwp <- CentWaveParam(snthresh = 5, noise = 100, ppm = 10,                      peakwidth = c(3, 30)) pest_all <- findChromPeaks(pest_all, param = cwp) head(chromPeaks(pest_all)) ##            mz    mzmin    mzmax      rt   rtmin   rtmax       into      intb ## CP01 142.9926 142.9921 142.9931 130.615 125.856 134.241  1113.8028  1106.229 ## CP02 221.0918 221.0906 221.0925 240.897 236.657 246.984   756.6935   744.779 ## CP03 220.0985 220.0978 220.0988 240.897 237.187 246.327  2060.5921  2052.549 ## CP04 219.0957 219.0950 219.0962 241.018 236.253 246.327 15172.6662 15133.811 ## CP05 153.0659 153.0655 153.0663 330.591 325.373 334.400  2148.7134  2141.943 ## CP06 235.1447 235.1441 235.1454 330.591 326.431 334.400  2836.2675  2829.627 ##           maxo  sn sample ## CP01  346.7006 102      1 ## CP02  212.5239  21      1 ## CP03  585.3036 151      1 ## CP04 4877.1162 367      1 ## CP05  784.9196 114      1 ## CP06 1006.9720 110      1 pest_ms2 <- chromPeakSpectra(pest_all, return.type = \"Spectra\") pest_ms2 ## MSn data (Spectra) with 158 spectra in a MsBackendMzR backend: ##            msLevel     rtime scanIndex ##          <integer> <numeric> <integer> ## F1.S1000         2   128.237      1000 ## F1.S1008         2   128.737      1008 ## F1.S1023         2   129.857      1023 ## F1.S1812         2   237.869      1812 ## F1.S1846         2   241.299      1846 ## ...            ...       ...       ... ## F1.S5115         2   575.255      5115 ## F1.S5272         2   596.584      5272 ## F1.S5236         2   592.424      5236 ## F1.S5266         2   596.054      5266 ## F1.S7344         2   873.714      7344 ##  ... 38 more variables/columns. ##  ## file(s): ## PestMix1_DDA.mzML pest_ms2$peak_id ##   [1] \"CP01\" \"CP01\" \"CP01\" \"CP04\" \"CP04\" \"CP05\" \"CP05\" \"CP06\" \"CP06\" \"CP08\" ##  [11] \"CP08\" \"CP11\" \"CP11\" \"CP12\" \"CP12\" \"CP13\" \"CP13\" \"CP13\" \"CP13\" \"CP14\" ##  [21] \"CP14\" \"CP14\" \"CP14\" \"CP18\" \"CP22\" \"CP22\" \"CP22\" \"CP22\" \"CP22\" \"CP25\" ##  [31] \"CP25\" \"CP25\" \"CP25\" \"CP25\" \"CP26\" \"CP26\" \"CP26\" \"CP26\" \"CP26\" \"CP26\" ##  [41] \"CP33\" \"CP33\" \"CP34\" \"CP34\" \"CP34\" \"CP34\" \"CP34\" \"CP35\" \"CP35\" \"CP35\" ##  [51] \"CP35\" \"CP35\" \"CP36\" \"CP41\" \"CP41\" \"CP41\" \"CP42\" \"CP42\" \"CP42\" \"CP42\" ##  [61] \"CP42\" \"CP44\" \"CP44\" \"CP46\" \"CP46\" \"CP46\" \"CP46\" \"CP47\" \"CP47\" \"CP47\" ##  [71] \"CP48\" \"CP48\" \"CP48\" \"CP50\" \"CP51\" \"CP51\" \"CP51\" \"CP52\" \"CP52\" \"CP52\" ##  [81] \"CP53\" \"CP53\" \"CP53\" \"CP53\" \"CP53\" \"CP57\" \"CP57\" \"CP57\" \"CP57\" \"CP57\" ##  [91] \"CP59\" \"CP59\" \"CP60\" \"CP60\" \"CP61\" \"CP61\" \"CP63\" \"CP63\" \"CP63\" \"CP63\" ## [101] \"CP64\" \"CP64\" \"CP64\" \"CP64\" \"CP64\" \"CP65\" \"CP66\" \"CP66\" \"CP66\" \"CP66\" ## [111] \"CP67\" \"CP67\" \"CP67\" \"CP69\" \"CP69\" \"CP69\" \"CP71\" \"CP71\" \"CP71\" \"CP71\" ## [121] \"CP72\" \"CP72\" \"CP72\" \"CP73\" \"CP81\" \"CP81\" \"CP81\" \"CP81\" \"CP82\" \"CP82\" ## [131] \"CP82\" \"CP85\" \"CP85\" \"CP88\" \"CP88\" \"CP89\" \"CP89\" \"CP89\" \"CP90\" \"CP90\" ## [141] \"CP90\" \"CP91\" \"CP91\" \"CP91\" \"CP93\" \"CP93\" \"CP93\" \"CP93\" \"CP93\" \"CP93\" ## [151] \"CP94\" \"CP94\" \"CP94\" \"CP94\" \"CP95\" \"CP98\" \"CP98\" \"CP99\" #' Remove peaks with an intensity below 5% pest_ms2 <- filterIntensity(pest_ms2, intensity = low_int)  #' Remove peaks with a single peak pest_ms2 <- pest_ms2[lengths(pest_ms2) > 1] #' Define a function to *normalize* the intensities norm_int <- function(x, ...) {     maxint <- max(x[, \"intensity\"], na.rm = TRUE)     x[, \"intensity\"] <- 100 * x[, \"intensity\"] / maxint     x } #' *Apply* the function to the data pest_ms2 <- addProcessing(pest_ms2, norm_int) mbank <- addProcessing(mbank, norm_int) pest_match <- matchSpectra(pest_ms2, mbank, param = prm) pest_match ## Object of class MatchedSpectra  ## Total number of matches: 31  ## Number of query objects: 155 (7 matched) ## Number of target objects: 86576 (19 matched) pest_match <- pest_match[whichQuery(pest_match)] pandoc.table(     style = \"rmarkdown\",     as.data.frame(spectraData(pest_match, c(\"peak_id\", \"rtime\",                                             \"target_compound_name\")))) plotSpectraMirror(pest_match[3])"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/Spectra-matching-with-MetaboAnnotation.html","id":"session-information","dir":"Articles","previous_headings":"","what":"Session information","title":"MS/MS Spectra Matching with the `MetaboAnnotation` Package","text":"","code":"sessionInfo() ## R version 4.3.0 (2023-04-21) ## Platform: x86_64-pc-linux-gnu (64-bit) ## Running under: Ubuntu 22.04.2 LTS ##  ## Matrix products: default ## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3  ## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0 ##  ## locale: ##  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               ##  [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8     ##  [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8    ##  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  ##  [9] LC_ADDRESS=C               LC_TELEPHONE=C             ## [11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C        ##  ## time zone: Etc/UTC ## tzcode source: system (glibc) ##  ## attached base packages: ## [1] stats4    stats     graphics  grDevices utils     datasets  methods   ## [8] base      ##  ## other attached packages: ##  [1] xcms_3.22.0             MSnbase_2.26.0          mzR_2.34.1              ##  [4] Rcpp_1.0.11             Biobase_2.60.0          MetaboAnnotation_1.5.1  ##  [7] MsBackendMassbank_1.7.4 RMariaDB_1.2.2          pander_0.6.5            ## [10] Spectra_1.11.9          ProtGenerics_1.33.1     BiocParallel_1.34.2     ## [13] S4Vectors_0.38.1        BiocGenerics_0.46.0     BiocStyle_2.28.0        ##  ## loaded via a namespace (and not attached): ##   [1] RColorBrewer_1.1-3          jsonlite_1.8.7              ##   [3] MultiAssayExperiment_1.26.0 magrittr_2.0.3              ##   [5] MALDIquant_1.22.1           rmarkdown_2.24              ##   [7] fs_1.6.3                    zlibbioc_1.46.0             ##   [9] ragg_1.2.5                  vctrs_0.6.3                 ##  [11] multtest_2.56.0             memoise_2.0.1               ##  [13] RCurl_1.98-1.12             base64enc_0.1-3             ##  [15] htmltools_0.5.6             S4Arrays_1.0.5              ##  [17] mzID_1.38.0                 sass_0.4.7                  ##  [19] bslib_0.5.1                 htmlwidgets_1.6.2           ##  [21] desc_1.4.2                  plyr_1.8.8                  ##  [23] impute_1.74.1               lubridate_1.9.2             ##  [25] cachem_1.0.8                igraph_1.5.1                ##  [27] lifecycle_1.0.3             iterators_1.0.14            ##  [29] pkgconfig_2.0.3             Matrix_1.6-1                ##  [31] R6_2.5.1                    fastmap_1.1.1               ##  [33] GenomeInfoDbData_1.2.10     MatrixGenerics_1.12.3       ##  [35] clue_0.3-64                 digest_0.6.33               ##  [37] pcaMethods_1.92.0           rsvg_2.4.0                  ##  [39] colorspace_2.1-0            rprojroot_2.0.3             ##  [41] textshaping_0.3.6           GenomicRanges_1.52.0        ##  [43] RSQLite_2.3.1               fansi_1.0.4                 ##  [45] timechange_0.2.0            abind_1.4-5                 ##  [47] compiler_4.3.0              bit64_4.0.5                 ##  [49] doParallel_1.0.17           DBI_1.1.3                   ##  [51] highr_0.10                  MASS_7.3-60                 ##  [53] ChemmineR_3.52.0            DelayedArray_0.26.7         ##  [55] rjson_0.2.21                tools_4.3.0                 ##  [57] CompoundDb_1.3.3            glue_1.6.2                  ##  [59] QFeatures_1.10.0            grid_4.3.0                  ##  [61] cluster_2.1.4               generics_0.1.3              ##  [63] gtable_0.3.4                preprocessCore_1.62.1       ##  [65] hms_1.1.3                   MetaboCoreUtils_1.8.0       ##  [67] xml2_1.3.5                  utf8_1.2.3                  ##  [69] XVector_0.40.0              RANN_2.6.1                  ##  [71] foreach_1.5.2               pillar_1.9.0                ##  [73] stringr_1.5.0               limma_3.56.2                ##  [75] splines_4.3.0               robustbase_0.99-0           ##  [77] dplyr_1.1.2                 lattice_0.21-8              ##  [79] survival_3.5-7              bit_4.0.5                   ##  [81] tidyselect_1.2.0            knitr_1.43                  ##  [83] gridExtra_2.3               IRanges_2.34.1              ##  [85] SummarizedExperiment_1.30.2 xfun_0.40                   ##  [87] matrixStats_1.0.0           DEoptimR_1.1-1              ##  [89] DT_0.28                     stringi_1.7.12              ##  [91] lazyeval_0.2.2              yaml_2.3.7                  ##  [93] evaluate_0.21               codetools_0.2-19            ##  [95] MsCoreUtils_1.12.0          tibble_3.2.1                ##  [97] BiocManager_1.30.22         cli_3.6.1                   ##  [99] affyio_1.70.0               systemfonts_1.0.4           ## [101] munsell_0.5.0               jquerylib_0.1.4             ## [103] MassSpecWavelet_1.66.0      GenomeInfoDb_1.36.1         ## [105] dbplyr_2.3.3                png_0.1-8                   ## [107] XML_3.99-0.14               parallel_4.3.0              ## [109] pkgdown_2.0.7               ggplot2_3.4.3               ## [111] blob_1.2.4                  AnnotationFilter_1.24.0     ## [113] bitops_1.0-7                MsFeatures_1.8.0            ## [115] scales_1.2.1                affy_1.78.2                 ## [117] ncdf4_1.21                  purrr_1.0.2                 ## [119] crayon_1.5.2                rlang_1.1.1                 ## [121] vsn_3.68.0"},{"path":[]},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"description","dir":"Articles","previous_headings":"Overview","what":"Description","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"Mass spectrometry (MS) data key technology modern proteomics metabolomics experiments. Due continuous improvements MS instrumentation, generated data can easily become large. Also, additional resources MS data exist, spectra libraries databases, specific file formats database systems sometimes support manipulations original data. Learning experiences MSnbase Bioconductor package, Spectra package developed provide even flexible expandable infrastructure MS data R. package implements clear separation user interface code provide, store import MS data. latter defined MsBackend interface allows implementation data type, format storage-dependent backends. Backends can thus implemented specific file types data resources different ways represent MS data (e.g. memory -disk data representations described (Gatto, Gibb, Rainer 2020)). also supposed interchangeable hence allowing user switch backends without affecting analysis. enable processing also large MS data sets, data manipulations default directly applied data cached lazy evaluation queue allows analyses also read-data representations. workshop shows expandability new infrastructure enable seamless integration analysis MS data variety input formats. illustrated simple comparison matching experimental MS2 spectra public spectral databases export data format commonly used exchange MS2 data.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"pre-requisites","dir":"Articles","previous_headings":"Overview","what":"Pre-requisites","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"Basic familiarity R Bioconductor. Basic understanding Mass Spectrometry (MS) data.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"installation-and-participation","dir":"Articles","previous_headings":"Overview","what":"Installation and Participation","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"Get docker image tutorial docker pull jorainer/spectra_tutorials:latest. Start docker using Enter http://localhost:8787 web browser log username rstudio password bioc. Open R-markdown file (vignettes/analyzing-MS-data--different-sources--Spectra.Rmd) RStudio server version web browser evaluate R code blocks.","code":"docker run \\     -e PASSWORD=bioc \\     -p 8787:8787 \\     jorainer/spectra_tutorials:latest"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"rbioconductor-packages-used","dir":"Articles","previous_headings":"Overview","what":"R/Bioconductor packages used","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"Spectra MsCoreUtils MsBackendMgf MsBackendMassbank CompoundDb","code":""},{"path":[]},{"path":[]},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"learning-goals","dir":"Articles","previous_headings":"Overview > Workshop goals and objectives","what":"Learning goals","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"Understand import MS data R. Understand basic concept backends Spectra can used work MS data various sources.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"learning-objectives","dir":"Articles","previous_headings":"Overview > Workshop goals and objectives","what":"Learning objectives","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"Import export MS data Spectra. Integrate MS data different resources MS data analysis workflow. Apply different data manipulations MS data represented Spectra object. Use Spectra perform spectra comparisons R.","code":""},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"lc-msms-in-a-nutshell","dir":"Articles","previous_headings":"Workshop","what":"LC-MS/MS in a nutshell","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"Mass spectrometry (MS) instruments measure mass--charge ratios (m/z) abundances ions. resulting m/z intensity values stored/represented spectrum. compounds charged, need ionized first (e.g. electro spray ionization (ESI)). MS usually combined another separation technique, liquid chromatography (LC). adds another dimension data: retention time (rt). LC-MS data represented multiple spectra, spectrum retention time. LC-MS setup LC-MS measure features characterized m/z retention time - still don’t know molecule actually measured. Create addition fragment (MS/MS) spectra ions get information structure. CID-based fragmentation Commonly used method: collision induced dissociation (CID). collision chamber filled e.g. N2, ions get fragmented spectrum fragments recorded (Steckel Schlosser 2019). Comparing matching fragment spectra reference helps identifying compound.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"the-spectra-package","dir":"Articles","previous_headings":"Workshop","what":"The Spectra package","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"Purpose: provide expandable, well tested user-friendly infrastructure mass spectrometry (MS) data. Design: separation user interface (functions) code provide, store read MS data. Advantage: support different ways store handle data without affecting user functionality: functionality Spectra object independent data , either -memory, -disk, locally remote. Expandable: implementation additional backend classes (extending MsBackend virtual class) possible add support additional input file formats data representations without needing change Spectra package object. Spectra: separation user functionality data representation workshop : import MS data mzML files, select MS2 spectra certain compound, compare match MS2 spectra reference MS2 spectra public database, annotate spectra export file MGF format.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"ms-data-import-and-handling","dir":"Articles","previous_headings":"Workshop","what":"MS data import and handling","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"import MS data mzML files provided within package. files contain MSn data mix 8 standard compounds (added either water pool human serum samples) measured HILIC-based LC-MS/MS setup. MS2 data generated data dependent acquisition using collision energy 20eV. data import representation experimental data use MsBackendMzR backend supports import (export) data common raw mass spectrometry file formats (.e. mzML, mzXML CDF). MS data now represented Spectra object, can thought data.frame rows individual spectra columns spectra variables (\"rtime\", .e. retention time). spectraVariables function lists available variables within Spectra object. spectra variable can accessed either via $ name using dedicated access function (preferred way). extract retention times first spectra using either $rtime function rtime. Spectra object contains information total 1578 spectra length(unique(dataOrigin(sps_all))) mzML files. using MsBackendMzR backend, general information spectrum kept memory resulting low memory footprint. spectra’s m/z intensity values can accessed mz intensity functions also peaksData function returns list numeric matrices m/z intensity values. using MsBackendMzR backend, retrieved demand original data files time functions called. can also load full data memory changing backend MsBackendMzR MsBackendDataFrame. affect way use Spectra object : operations functions available, independently way data stored (.e. backend used). size Spectra object now larger, since full data loaded memory. subset Spectra objects, can use either [ one many available filter* functions (usually efficient [). subset sps_all arbitrary spectra simply using: workshop, next want identify experimental data MS2 spectra generated ion matches m/z [M+H]+ ion metabolite cystine (one standards added sample mix measured present experimental data). thus use filterPrecursorMzValues function subset data MS2 spectra matching m/z (accepting difference m/z 10 parts-per-million (ppm)). total 6 spectra matched target precursor m/z.","code":"library(Spectra)  #' Define the input files fls <- dir(system.file(\"mzML\", package = \"SpectraTutorials\"),            full.names = TRUE)  #' Import the data sps_all <- Spectra(fls, source = MsBackendMzR()) #' List all available spectra variables (attributes) spectraVariables(sps_all) ##  [1] \"msLevel\"                  \"rtime\"                    ##  [3] \"acquisitionNum\"           \"scanIndex\"                ##  [5] \"dataStorage\"              \"dataOrigin\"               ##  [7] \"centroided\"               \"smoothed\"                 ##  [9] \"polarity\"                 \"precScanNum\"              ## [11] \"precursorMz\"              \"precursorIntensity\"       ## [13] \"precursorCharge\"          \"collisionEnergy\"          ## [15] \"isolationWindowLowerMz\"   \"isolationWindowTargetMz\"  ## [17] \"isolationWindowUpperMz\"   \"peaksCount\"               ## [19] \"totIonCurrent\"            \"basePeakMZ\"               ## [21] \"basePeakIntensity\"        \"ionisationEnergy\"         ## [23] \"lowMZ\"                    \"highMZ\"                   ## [25] \"mergedScan\"               \"mergedResultScanNum\"      ## [27] \"mergedResultStartScanNum\" \"mergedResultEndScanNum\"   ## [29] \"injectionTime\"            \"filterString\"             ## [31] \"spectrumId\"               \"ionMobilityDriftTime\"     ## [33] \"scanWindowLowerLimit\"     \"scanWindowUpperLimit\" #' Access the spectras' retention time sps_all$rtime |> head() ## [1] 0.273 0.570 0.873 1.183 1.491 1.798 rtime(sps_all) |> head() ## [1] 0.273 0.570 0.873 1.183 1.491 1.798 print(object.size(sps_all), units = \"MB\") ## 0.4 Mb ## Show the first 6 lines of the first spectrum's peak matrix peaksData(sps_all)[[1L]] |> head() ##            mz intensity ## [1,] 50.22647  383.7802 ## [2,] 52.97586  377.5944 ## [3,] 59.97846  518.6014 ## [4,] 60.04677 4716.1259 ## [5,] 60.06897  181.5105 ## [6,] 61.02565  250.6573 #' Change backend to a MsBackendDataFrame: load data into memory sps_all <- setBackend(sps_all, MsBackendDataFrame()) print(object.size(sps_all), units = \"MB\") ## 16.5 Mb sps_all[c(4, 2, 5)] ## MSn data (Spectra) with 3 spectra in a MsBackendDataFrame backend: ##     msLevel     rtime scanIndex ##   <integer> <numeric> <integer> ## 1         1     1.183         4 ## 2         1     0.570         2 ## 3         1     1.491         5 ##  ... 33 more variables/columns. ## Processing: ##  Switch backend from MsBackendMzR to MsBackendDataFrame [Tue Aug 22 06:50:04 2023] #' Define the m/z ratio for an ion of cystine mz <- 241.0311  #' Subset the dataset to MS2 spectra matching the m/z sps <- filterPrecursorMzValues(sps_all, mz = mz, ppm = 10) sps ## MSn data (Spectra) with 6 spectra in a MsBackendDataFrame backend: ##     msLevel     rtime scanIndex ##   <integer> <numeric> <integer> ## 1         2   209.936       673 ## 2         2   220.072       714 ## 3         2   231.604       734 ## 4         2   215.089       761 ## 5         2   225.739       781 ## 6         2   240.020       804 ##  ... 33 more variables/columns. ## Processing: ##  Switch backend from MsBackendMzR to MsBackendDataFrame [Tue Aug 22 06:50:04 2023] ##  Filter: select spectra with precursor m/z matching 241.0311 [Tue Aug 22 06:50:05 2023]"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"data-processing-and-manipulation","dir":"Articles","previous_headings":"Workshop","what":"Data processing and manipulation","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"plotSpectra function can used visualize spectra. plot first spectrum data subset.  raw MS2 spectrum contains many low intensity peaks, likely representing noise. Thus next filter spectra removing peaks intensity smaller 5% maximum intensity spectrum (.e. base peak intensity). end define function takes intensity values spectrum input returns logical value whether peak retained (TRUE) (FALSE). function passed filterIntensity function perform actual filtering spectra. filtering, spectra cleaner:  addition want replace absolute peak intensities values relative spectrum’s highest peak intensity. end define function takes peak matrix input (.e. numeric matrix columns containing m/z intensity values) returns two-column numeric matrix. function passed parameter FUN addProcessing function perform desired data processing. addProcessing function allows add user-defined data manipulation operation MS data (.e. peaks matrices) Spectra object. show effect data processing extract intensities first spectrum: intensity values now 0 100.","code":"#' Plot the first spectrum plotSpectra(sps[1]) #' Define a filtering function low_int <- function(x, ...) {     x > max(x, na.rm = TRUE) * 0.05 } #' Apply the function to filter the spectra sps <- filterIntensity(sps, intensity = low_int) #' Plot the first spectrum after filtering plotSpectra(sps[1]) #' Define a function to scale the intensities. `x` is expected to be a #' *peak matrix*, i.e. numeric matrix with columns m/z and intensity scale_int <- function(x, ...) {     maxint <- max(x[, \"intensity\"], na.rm = TRUE)     x[, \"intensity\"] <- 100 * x[, \"intensity\"] / maxint     x } #' *Apply* the function to the data sps <- addProcessing(sps, scale_int) #' Get the intensities after scaling peaksData(sps)[[1L]] ##             mz  intensity ## [1,]  74.02289  13.439402 ## [2,] 120.01111  93.631648 ## [3,] 122.02667  49.287979 ## [4,] 151.98277 100.000000 ## [5,] 153.99924   9.422415 ## [6,] 177.99880   6.581111 ## [7,] 195.02556  12.969807 ## [8,] 241.03074  54.633224"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"spectrum-data-comparison","dir":"Articles","previous_headings":"Workshop","what":"Spectrum data comparison","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"next perform pairwise comparison subsetted spectra using dot product similarity measure. Prior actual similarity calculation, peaks individual spectra matched (.e. determined peak one spectrum correspond spectrum based mass--charge ratios). specify ppm = 20 peaks difference m/z smaller 20ppm considered matching. default, compareSpectra uses (normalized) dot-product calculate similarity spectra, variety different algorithms can used instead (see Spectra vignette information). pairwise spectra similarities represented heatmap (note RStudio docker might crash pheatmap call - avoid add filename = \"hm.pdf\" heatmap call).  similarity selected experimental MS2 spectra high (fact 0.88) suggesting fragment spectra original compound.","code":"#' Pairwise comparison of all spectra sim_mat <- compareSpectra(sps, ppm = 20) sim_mat ##           [,1]      [,2]      [,3]      [,4]      [,5]      [,6] ## [1,] 1.0000000 0.9717669 0.8907129 0.9721095 0.8795912 0.8818719 ## [2,] 0.9717669 1.0000000 0.9992127 0.9964783 0.9525726 0.9486682 ## [3,] 0.8907129 0.9992127 1.0000000 0.9947650 0.9518138 0.9478201 ## [4,] 0.9721095 0.9964783 0.9947650 1.0000000 0.9543584 0.9494561 ## [5,] 0.8795912 0.9525726 0.9518138 0.9543584 1.0000000 0.9994800 ## [6,] 0.8818719 0.9486682 0.9478201 0.9494561 0.9994800 1.0000000 library(pheatmap) hm <- pheatmap(sim_mat, breaks = seq(0, 1, length.out = 101))"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"comparing-spectra-against-massbank","dir":"Articles","previous_headings":"Workshop","what":"Comparing spectra against MassBank","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"Although precursor m/z spectra matches m/z cystine, can still exclude represent fragments ions different compounds (m/z cystine). Matching experimental spectra public spectral library can used first step identification process untargeted metabolomics data. Several (public) spectral libraries small molecules available, : MassBank MassBank North America MoNa Human Metabolom Database HMDB GNPS … databases MsBackend interfaces already implemented allowing inclusion data directly R-based analysis workflows. Access MassBank data example possible MsBackendMassbank package. package provides MsBackendMassbank import/export MassBank files well MsBackendMassbankSql backend directly interfaces MassBank MySQL database. connect local installation MassBank MySQL database (release 2021.03 provided within docker image tutorial). next load MsBackendMassbank package initialize Spectra object MsBackendMassbankSql backend providing database connection. Alternatively, MySQL database system available tutorial can run within docker, MassBank data can also retrieved Bioconductor’s AnnotationHub. case MsBackendCompDb backend (defined CompoundDb) used instead, backends retrieve data SQL database properties. list MassBank releases/versions available Bioconductor’s AnnotationHub. can retrieve respective release access spectra data code . Note AnnotationHub cache downloaded database locally subsequent call download database . Spectra object mbank represents now MS data MassBank database total length(mbank) spectra. fact, mbank object contain MS data, primary keys spectra MassBank database. Hence, also relatively low memory footprint. operation Spectra object backend load requested data database demand. Calling intensity Spectra object example retrieve intensity values spectra database. extract peaks matrix first spectrum. can see, also MassBank provides absolute intensities spectrum. data scale, however like scale values 0 100, just like experimental data. thus apply data processing operation also MassBank Spectra object. worked, although (obvious reasons) allowed change m/z intensity values within MassBank database. possible? works, data manipulation operation Spectra object cached within object’s lazy evaluation queue operation applied m/z intensity values --fly whenever data requested (.e. whenever mz intensity called ). side effect, also allows undo certain data operations simply calling reset Spectra object. next want compare experimental spectra spectra MassBank. Instead comparing 86576 available spectra, first filter MassBank database spectra precursor m/z matching one [M+H]+ ion cystine. Note , alternative filterPrecursorMzValues used , also use containsMz function screen spectra containing actual peak matching precursor m/z. left us 12 spectra calculate similarity experimental spectra using compareSpectra function. result got (normalized dot product) similarity score tested MassBank spectrum (columns) experimental spectrum (rows).  get high similarity scores, also lower ones. next determine best matching pair comparisons. best_match variable contains now index best matching MassBank experimental spectrum. visualize two using mirror plot showing best matches experimental spectra (upper panel) fragment spectra MassBank (lower panel). Matching peaks highlighted blue color. Plotting functions Spectra highly customizable example add m/z individual peak annotation intensity peak higher 5.  comparison plot also two spectra low similarity score.  Since identify MassBank spectrum high similarity experimental spectra also like know compound spectrum actually represents. Spectra objects generally flexible can arbitrarily many additional annotation fields (.e. spectra variables) spectrum. Thus, use spectraVariables function list variables available MassBank Spectra object. fact, addition spectra specific information like instrument measured ionization voltage used, get also information originating compound name (\"compound_name\"), chemical formula (\"formula\") INChI key (\"inchikey\"). thus next subset mbank_sub best matching spectrum display associated compound name. Note database provided AnnotationHub contain compound names column/spectra variable \"name\" instead \"compound_name\", thus, used option download MassBank data AnnotationHub , use mbank_best_match$name instead mbank_best_match$compound_name . Indeed, experimental cystine spectrum matches (one) cystine spectrum MassBank. next add name chemical formula spectrum experimental spectra. also set collision energy 20eV assign ion/adduct cystine reference spectrum created. Spectra allows adding new (replacing existing) spectra variables using $<-. Note: convenient spectra matching functionality designed less experienced R users available MetaboAnnotation package. second tutorial available within github repository/R package additional tutorials can found MetaboAnnotationTutorials repository/R package.","code":"library(RMariaDB) #' Connect to the MassBank MySQL database con <- dbConnect(MariaDB(), user = \"massbank\", dbname = \"MassBank\",                  host = \"localhost\", pass = \"massbank\") library(MsBackendMassbank) #' Access the spectra data in MassBank mbank <- Spectra(con, source = MsBackendMassbankSql()) mbank ## MSn data (Spectra) with 86576 spectra in a MsBackendMassbankSql backend: ##         msLevel precursorMz  polarity ##       <integer>   <numeric> <integer> ## 1             2         506         0 ## 2            NA          NA         1 ## 3            NA          NA         0 ## 4            NA          NA         1 ## 5            NA          NA         0 ## ...         ...         ...       ... ## 86572         2     449.380         1 ## 86573         2     426.022         0 ## 86574         2     131.060         0 ## 86575         2     183.170         1 ## 86576         2     358.270         0 ##  ... 42 more variables/columns. ##  Use  'spectraVariables' to list all of them. library(AnnotationHub) ah <- AnnotationHub() query(ah, \"MassBank\") ## AnnotationHub with 3 records ## # snapshotDate(): 2023-04-24 ## # $dataprovider: MassBank ## # $species: NA ## # $rdataclass: CompDb ## # additional mcols(): taxonomyid, genome, description, ## #   coordinate_1_based, maintainer, rdatadateadded, preparerclass, tags, ## #   rdatapath, sourceurl, sourcetype  ## # retrieve records with, e.g., 'object[[\"AH107048\"]]'  ##  ##              title                                 ##   AH107048 | MassBank CompDb for release 2021.03   ##   AH107049 | MassBank CompDb for release 2022.06   ##   AH111334 | MassBank CompDb for release 2022.12.1 mb <- ah[[\"AH107048\"]] mbank <- Spectra(mb) print(object.size(mbank), units = \"MB\") ## 6.6 Mb #' Get peaks matrix for the first spectrum peaksData(mbank[1])[[1L]] ##             mz    intensity ##  [1,] 146.7608     0.980184 ##  [2,] 158.8635   938.145447 ##  [3,] 174.9888    56.718353 ##  [4,] 176.8688   847.169678 ##  [5,] 213.9867   133.479233 ##  [6,] 221.0402     3.189743 ##  [7,] 238.9681    76.114944 ##  [8,] 246.3159     2.592528 ##  [9,] 255.0206     2.059480 ## [10,] 256.8184     1.597428 ## [11,] 272.9973   801.059082 ## [12,] 290.9484     4.848598 ## [13,] 293.9753     1.233919 ## [14,] 310.1210    33.710808 ## [15,] 352.9528    49.103123 ## [16,] 370.9348   461.860779 ## [17,] 390.0576     4.611422 ## [18,] 408.0003 23963.912109 ## [19,] 409.0284     0.884388 ## [20,] 426.1263    69.098648 ## [21,] 470.0574     2.051622 ## [22,] 487.9893   812.386597 ## [23,] 585.8845     1.093564 #' Scale intensities for all MassBank spectra mbank <- addProcessing(mbank, scale_int) peaksData(mbank[1])[[1L]] ##             mz    intensity ##  [1,] 146.7608 4.090250e-03 ##  [2,] 158.8635 3.914826e+00 ##  [3,] 174.9888 2.366824e-01 ##  [4,] 176.8688 3.535189e+00 ##  [5,] 213.9867 5.570010e-01 ##  [6,] 221.0402 1.331061e-02 ##  [7,] 238.9681 3.176232e-01 ##  [8,] 246.3159 1.081847e-02 ##  [9,] 255.0206 8.594089e-03 ## [10,] 256.8184 6.665973e-03 ## [11,] 272.9973 3.342773e+00 ## [12,] 290.9484 2.023292e-02 ## [13,] 293.9753 5.149072e-03 ## [14,] 310.1210 1.406732e-01 ## [15,] 352.9528 2.049045e-01 ## [16,] 370.9348 1.927318e+00 ## [17,] 390.0576 1.924319e-02 ## [18,] 408.0003 1.000000e+02 ## [19,] 409.0284 3.690499e-03 ## [20,] 426.1263 2.883446e-01 ## [21,] 470.0574 8.561298e-03 ## [22,] 487.9893 3.390042e+00 ## [23,] 585.8845 4.563378e-03 #' Filter MassBank for spectra of precursor ion mbank_sub <- filterPrecursorMzValues(mbank, mz = mz, ppm = 10) mbank_sub ## MSn data (Spectra) with 12 spectra in a MsBackendMassbankSql backend: ##       msLevel precursorMz  polarity ##     <integer>   <numeric> <integer> ## 1           2     241.031         1 ## 2           2     241.031         1 ## 3           2     241.031         1 ## 4           2     241.031         1 ## 5           2     241.031         1 ## ...       ...         ...       ... ## 8           2     241.031         1 ## 9           2     241.031         1 ## 10          2     241.031         1 ## 11          2     241.031         1 ## 12          2     241.031         1 ##  ... 42 more variables/columns. ##  Use  'spectraVariables' to list all of them. ## Lazy evaluation queue: 1 processing step(s) ## Processing: ##  Filter: select spectra with precursor m/z matching 241.0311 [Tue Aug 22 06:50:15 2023] #' Compare MassBank subset to experimental spectra res <- compareSpectra(sps, mbank_sub, ppm = 20) res ##       RP014401  RP014402    RP014403  CE000600  CE000598  CE000602  CE000595 ## [1,] 0.2026317 0.3343503 0.024658599 0.9021127 0.9069832 0.7714246 0.4711052 ## [2,] 0.1807144 0.2933160 0.021440961 0.8863867 0.8655798 0.7507946 0.4307388 ## [3,] 0.1801990 0.2892779 0.005165072 0.8862688 0.8541779 0.7335706 0.4406949 ## [4,] 0.1596113 0.3067826 0.005668103 0.8666230 0.8760503 0.7770975 0.4382448 ## [5,] 0.1784321 0.3608116 0.005392068 0.8792278 0.9101864 0.7761744 0.5016645 ## [6,] 0.1871595 0.3629835 0.005564441 0.8849054 0.8705634 0.7200598 0.5052482 ##       CE000599  CE000596  CE000597  CE000603  CE000601 ## [1,] 0.5101048 0.7358534 0.2843629 0.6267950 0.6085564 ## [2,] 0.5304578 0.7415840 0.3069911 0.6079285 0.5669921 ## [3,] 0.5379880 0.7480320 0.3157130 0.6220260 0.5458613 ## [4,] 0.4738241 0.6957804 0.2580864 0.5819616 0.6049588 ## [5,] 0.4913249 0.7185230 0.2783447 0.6469762 0.6055037 ## [6,] 0.5013606 0.7278495 0.2864854 0.6554185 0.5523657 pheatmap(res) best_match <- which(res == max(res), arr.ind = TRUE) best_match ##      row col ## [1,]   5   5 #' Specifying a function to draw peak labels label_fun <- function(x) {     ints <- unlist(intensity(x))     mzs <- format(unlist(mz(x)), digits = 4)     mzs[ints < 5] <- \"\"     mzs } plotSpectraMirror(sps[best_match[1]], mbank_sub[best_match[2]],                   ppm = 20, labels = label_fun, labelPos = 2,                   labelOffset = 0.2, labelSrt = -30) grid() plotSpectraMirror(sps[3], mbank_sub[1],                   ppm = 20, labels = label_fun, labelPos = 2,                   labelOffset = 0.2, labelSrt = -30) grid() #' What variables are available in MassBank spectraVariables(mbank_sub) ##  [1] \"msLevel\"                 \"rtime\"                   ##  [3] \"acquisitionNum\"          \"scanIndex\"               ##  [5] \"dataStorage\"             \"dataOrigin\"              ##  [7] \"centroided\"              \"smoothed\"                ##  [9] \"polarity\"                \"precScanNum\"             ## [11] \"precursorMz\"             \"precursorIntensity\"      ## [13] \"precursorCharge\"         \"collisionEnergy\"         ## [15] \"isolationWindowLowerMz\"  \"isolationWindowTargetMz\" ## [17] \"isolationWindowUpperMz\"  \"spectrum_id\"             ## [19] \"spectrum_name\"           \"date\"                    ## [21] \"authors\"                 \"license\"                 ## [23] \"copyright\"               \"publication\"             ## [25] \"splash\"                  \"compound_id\"             ## [27] \"adduct\"                  \"ionization\"              ## [29] \"ionization_voltage\"      \"fragmentation_mode\"      ## [31] \"collision_energy_text\"   \"instrument\"              ## [33] \"instrument_type\"         \"formula\"                 ## [35] \"exactmass\"               \"smiles\"                  ## [37] \"inchi\"                   \"inchikey\"                ## [39] \"cas\"                     \"pubchem\"                 ## [41] \"synonym\"                 \"precursor_mz_text\"       ## [43] \"compound_name\" mbank_best_match <- mbank_sub[best_match[2]] mbank_best_match$compound_name ## [1] \"Cystine\" #' Add annotations to the experimental spectra sps$name <- mbank_best_match$compound_name sps$formula <- mbank_best_match$formula sps$adduct <- mbank_best_match$adduct sps$collisionEnergy <- 20"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"data-export","dir":"Articles","previous_headings":"Workshop","what":"Data export","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"last want export spectra file MGF format. use MsBackendMgf package provides MsBackendMgf backend adds support MGF file import/export Spectra objects. Data Spectra objects can generally exported export function. format data exported depends specified MsBackend class. using instance MsBackendMgf define export data file MGF format. read first 6 lines resulting file.","code":"library(MsBackendMgf)  #' Export the spectra to a MGF file export(sps, backend = MsBackendMgf(), file = \"Cystine_ce20.mgf\") readLines(\"Cystine_ce20.mgf\", n = 6) ## [1] \"BEGIN IONS\"                                ## [2] \"TITLE=msLevel 2; retentionTime ; scanNum \" ## [3] \"msLevel=2\"                                 ## [4] \"RTINSECONDS=209.93599999998\"               ## [5] \"SCANS=673\"                                 ## [6] \"scanIndex=673\""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"comparing-spectra-against-hmdb","dir":"Articles","previous_headings":"Workshop","what":"Comparing spectra against HMDB","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"addition MsBackendMassbank, provides access MassBank data, also MsBackendHmdb package supporting spectral data public Human Metabolome Database (HMDB). package however yet provide direct access HMDB database , MsBackendHmdbXml backend, allows import MS2 spectra files HMDB format. provided HMDB individual xml files custom file format bundled (can hence downloaded) single archive. alternative, also possible create portable annotation resources using CompoundDb package. packages allows example create annotation databases MoNA, MassBank HMDB. CompDb annotations small compounds different resources become available also Bioconductors AnnotationHub. CompDb database containing compound annotations along (experimental) MS2 spectra provided data release MetaboAnnotationTutorials repository. download SQLite database temporary file. can now load annotation resource using CompDb function CompoundDb package: can now create Spectra object get access MS2 spectra within package: now Spectra object containing MS2 spectra HMDB along compound annotations. spectra variables (including compound annotations) available spectrum : Also , want filter data resource first spectra matching precursor m/z. Unfortunately, HMDB provided spectra’s precursor m/z hence need used containsMz function find spectra containing peak m/z matching m/z ion interest. addition, need use rather large tolerance value (defines maximal acceptable absolute difference m/z values) since experimental spectra HMDB seem recorded well calibrated instrument. total 3904 spectra contain peak required m/z (+/- 0.2 Dalton) can proceed calculate spectral similarities experimental spectra. highest similarity spectra spectra HMDB r max(res). compare two best matching spectra mirror plot, upper panel showing experimental spectrum lower panel best matching MS2 spectrum HMDB.  experimental spectrum seems nicely match reference MS2 HMDB. extract compound identifier best matching HMDB spectrum (stored spectra variable called \"compound_id\") name compound fact, matching spectrum HMDB experimental spectrum L-Cystine.","code":"#' Download the CompDb database using curl library(curl) dbname <- \"CompDb.Hsapiens.HMDB.5.0.sqlite\" db_file <- file.path(tempdir(), dbname) curl_download(     paste0(\"https://github.com/jorainer/MetaboAnnotationTutorials/\",            \"releases/download/2021-11-02/\", dbname),     destfile = db_file) library(CompoundDb) #' Load a CompDb database with compound annotation from HMDB cdb <- CompDb(db_file) cdb ## class: CompDb  ##  data source: HMDB  ##  version: 5.0  ##  organism: Hsapiens  ##  compound count: 217776  ##  MS/MS spectra count: 64920 hmdb <- Spectra(cdb) hmdb ## MSn data (Spectra) with 64920 spectra in a MsBackendCompDb backend: ##         msLevel precursorMz  polarity ##       <integer>   <numeric> <integer> ## 1            NA          NA         1 ## 2            NA          NA         1 ## 3            NA          NA         1 ## 4            NA          NA         1 ## 5            NA          NA         1 ## ...         ...         ...       ... ## 64916        NA          NA         0 ## 64917        NA          NA         0 ## 64918        NA          NA         0 ## 64919        NA          NA         0 ## 64920        NA          NA         1 ##  ... 32 more variables/columns. ##  Use  'spectraVariables' to list all of them. ##  data source: HMDB  ##  version: 5.0  ##  organism: Hsapiens spectraVariables(hmdb) ##  [1] \"msLevel\"                 \"rtime\"                   ##  [3] \"acquisitionNum\"          \"scanIndex\"               ##  [5] \"dataStorage\"             \"dataOrigin\"              ##  [7] \"centroided\"              \"smoothed\"                ##  [9] \"polarity\"                \"precScanNum\"             ## [11] \"precursorMz\"             \"precursorIntensity\"      ## [13] \"precursorCharge\"         \"collisionEnergy\"         ## [15] \"isolationWindowLowerMz\"  \"isolationWindowTargetMz\" ## [17] \"isolationWindowUpperMz\"  \"compound_id\"             ## [19] \"name\"                    \"inchi\"                   ## [21] \"inchikey\"                \"formula\"                 ## [23] \"exactmass\"               \"smiles\"                  ## [25] \"original_spectrum_id\"    \"predicted\"               ## [27] \"splash\"                  \"instrument_type\"         ## [29] \"instrument\"              \"spectrum_id\"             ## [31] \"msms_mz_range_min\"       \"msms_mz_range_max\"       ## [33] \"synonym\" #' Identify spectra containing a peak matching cystine m/z has_mz <- containsMz(hmdb, mz = mz, tolerance = 0.2) #' Subset HMDB hmdb_sub <- hmdb[has_mz] #' Compare HMDB against experimental spectra res <- compareSpectra(hmdb_sub, sps, tolerance = 0.2) best_match <- which(res == max(res), arr.ind = TRUE) ## Specifying a function to draw peak labels label_fun <- function(x) {     format(unlist(mz(x)), digits = 4) } plotSpectraMirror(hmdb_sub[best_match[1]], sps[best_match[2]], tolerance = 0.2,                   labels = label_fun, labelPos = 2, labelOffset = 0.2,                   labelSrt = -30) grid() hmdb_sub[best_match[1]]$compound_id ## [1] \"HMDB0000192\" hmdb_sub[best_match[1]]$name ## [1] \"L-Cystine\""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"an-alternative-way-to-store-ms-data","dir":"Articles","previous_headings":"Workshop","what":"An alternative way to store MS data","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"use cases might useful store data whole MS experiments central place. MsBackendSql backend allows example store data relational database, simple SQLite files MySQL/MariaDB database systems. latter case allow also remote access centrally stored data set. Also, performance, especially large datasets much better MySQL database compared SQLite database used . section show data MS experiment can inserted database can retrieved. create empty SQLite database (temporary file). detailed , SQL database system used instead (resulting eventually even better performance). can next import data example experiment selected database. MsBackendSql allows now access use MS data stored database. simply provide connection database parameter Spectra function use MsBackendSql backend. memory footprint Spectra object small data retrieved database --fly. performance backend also higher example MsBackendMzR. compare performance MsBackendSql present small data set MsBackendDataFrame (data -memory) MsBackendMzR (data retrieved original file). Thus, MsBackendSql similar performance data memory. performance even better smaller subsets data loaded. real world use case backend store large MS experiment central place. Data analysts connect central database, explore subset data ultimately either load subsets data (local) memory changing backend data subset e.g. MsBackendDataFrame store data subset local files e.g. mzML format using export method MsBackendMzR backend.","code":"library(RSQLite) scon <- dbConnect(SQLite(), tempfile()) library(MsBackendSql) ## Warning: multiple methods tables found for 'uniqueMsLevels' ## Create a database containing the full raw data createMsBackendSqlDatabase(scon, fls) ## [1] TRUE sps_db <- Spectra(scon, source = MsBackendSql()) sps_db ## MSn data (Spectra) with 1578 spectra in a MsBackendSql backend: ##        msLevel precursorMz  polarity ##      <integer>   <numeric> <integer> ## 1            1          NA         1 ## 2            1          NA         1 ## 3            1          NA         1 ## 4            1          NA         1 ## 5            1          NA         1 ## ...        ...         ...       ... ## 1574         2    130.9659         1 ## 1575         2    175.1178         1 ## 1576         2    193.9281         1 ## 1577         2    107.9501         1 ## 1578         2     95.0608         1 ##  ... 34 more variables/columns. ##  Use  'spectraVariables' to list all of them. ## Database: /tmp/RtmpuFEsL6/file716d477af3 print(object.size(sps_db), units = \"MB\") ## 0.1 Mb ## Load the data to different backends sps_mzr <- Spectra(fls, source = MsBackendMzR()) sps_df <- setBackend(sps_mzr, MsBackendDataFrame())  library(microbenchmark) microbenchmark(peaksData(sps_mzr),                peaksData(sps_df),                peaksData(sps_db),                times = 10) ## Unit: milliseconds ##                expr      min       lq     mean   median       uq       max ##  peaksData(sps_mzr) 340.8487 382.7865 593.3744 412.2223 456.4807 2290.1109 ##   peaksData(sps_df) 104.2550 106.0419 122.2282 122.1488 131.0722  148.3805 ##   peaksData(sps_db)  66.7072  81.9432 159.9766  95.0057 108.4391  781.4238 ##  neval ##     10 ##     10 ##     10 microbenchmark(peaksData(sps_mzr[1:10]),                peaksData(sps_df[1:10]),                peaksData(sps_db[1:10]),                times = 10) ## Unit: milliseconds ##                      expr     min      lq     mean   median      uq     max ##  peaksData(sps_mzr[1:10]) 14.0721 14.1249 14.44898 14.41550 14.7408 14.9954 ##   peaksData(sps_df[1:10])  5.7341  5.8669  6.09682  5.91935  6.1779  7.4394 ##   peaksData(sps_db[1:10])  4.2602  4.4637  4.94411  4.58875  4.7203  8.4209 ##  neval ##     10 ##     10 ##     10"},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"short-summary","dir":"Articles","previous_headings":"","what":"Short summary","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"Spectra provides powerful infrastructure MS data. Independence data analysis data storage functionality allows easily add support additional data types data handling/storage modes. Caching data operations applying --fly allows data manipulations regardless data stored.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"summary","dir":"Articles","previous_headings":"","what":"Summary","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"simple use case matching experimental MS2 spectra public database illustrated short tutorial flexibility expandability Spectra package enables seamless integration mass spectrometry data different sources. possible clear separation user functionality (Spectra object) representation data (MsBackend object). Backends MsBackendMgf, MsBackendMassbank MsBackendHmdbXml provide support additional data formats data sources, others, due much lower memory footprint (MsBackendMzR, MsBackendHdf5Peaks), enable analysis also large data sets. importantly however, backends interchangeable affect way users can handle analyze MS data Spectra package. Also, caching data operations within Spectra object applying upon data requests, data operations can applied data resource regardless data stored, even data read-.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/articles/analyzing-MS-data-from-different-sources-with-Spectra.html","id":"what-else","dir":"Articles","previous_headings":"","what":"What else?","title":"Seamless Integration of Mass Spectrometry Data from Different Sources with the `Spectra` Package","text":"MetaboAnnotation (Andrea Vicini, Michael Witting) provide simple functions matching spectra m/z retention time data (Rainer et al. 2022). MsExperiment represent whole MS experiments (incl. Spectra, sample annotation, data quantitation, annotation files etc). msQC (Thomas Naake): QC measures MS data. MsBackendMsp (Steffen Neumann): backend files MSP format. ...","code":""},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Johannes Rainer. Author, maintainer. Michael Witting. Author. Laurent Gatto. Author. Sebastian Gibb. Author.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Rainer J, Witting M, Gatto L, Gibb S (2023). SpectraTutorials: Mass Spectrometry Data Analysis Spectra. R package version 0.8.0, https://jorainer.github.io/SpectraTutorials/.","code":"@Manual{,   title = {SpectraTutorials: Mass Spectrometry Data Analysis with Spectra},   author = {Johannes Rainer and Michael Witting and Laurent Gatto and Sebastian Gibb},   year = {2023},   note = {R package version 0.8.0},   url = {https://jorainer.github.io/SpectraTutorials/}, }"},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"mass-spectrometry-data-analysis-with-spectra","dir":"","previous_headings":"","what":"Mass Spectrometry Data Analysis with Spectra","title":"Mass Spectrometry Data Analysis with Spectra","text":"Tutorials workshops describing explaining infrastructure mass spectrometry (MS) data analysis centered around Bioconductor’s Spectra package. Workshops also given (either -person virtually) various conferences. available, recordings linked respective workshop section. See NEWS.md differences versions change log.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Mass Spectrometry Data Analysis with Spectra","text":"-line code evaluation workshops can also run using self-contained docker image R packages server version RStudio (Posit) pre-installed. alternative, rendered versions workshops available SpectraTutorials (navigate Articles drop-menu select workshop interest). installation: Get docker image tutorial docker pull jorainer/spectra_tutorials:latest. Start docker using Enter http://localhost:8787 web browser log username rstudio password bioc. RStudio server version: open R-markdown (.Rmd) files vignettes folder evaluate R code blocks.","code":"docker run \\     -e PASSWORD=bioc \\     -p 8787:8787 \\     jorainer/spectra_tutorials:latest"},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"seamless-integration-of-mass-spectrometry-data-from-different-sources","dir":"","previous_headings":"","what":"Seamless Integration of Mass Spectrometry Data from Different Sources","title":"Mass Spectrometry Data Analysis with Spectra","text":"rendered version","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"short-description","dir":"","previous_headings":"Seamless Integration of Mass Spectrometry Data from Different Sources","what":"Short description","title":"Mass Spectrometry Data Analysis with Spectra","text":"workshop use Spectra : import MS data mzML files, select MS2 spectra certain compound, compare match MS2 spectra reference MS2 spectra public database, annotate spectra export file MGF format.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"description","dir":"","previous_headings":"Seamless Integration of Mass Spectrometry Data from Different Sources","what":"Description","title":"Mass Spectrometry Data Analysis with Spectra","text":"(instructor-led live demo) workshop explains Spectra package shows new infrastructure can used represent analyze Mass Spectrometry (MS) data. use different data type format specific backends guarantees easy expandability infrastructure. illustrated tutorial simple use case, MS/MS (.k.. MS2) spectra, measured MS instrument, compared matched public spectral database containing public domain reference MS2 spectra. video recording workshop BioC2021 conference available . video recording workshop EuroBioc2020 conference available .","code":""},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"learning-goals","dir":"","previous_headings":"Seamless Integration of Mass Spectrometry Data from Different Sources > Workshop goals and objectives","what":"Learning goals","title":"Mass Spectrometry Data Analysis with Spectra","text":"Understand import MS data R. Understand basic concept different backends can used Spectra work MS data various sources.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"learning-objectives","dir":"","previous_headings":"Seamless Integration of Mass Spectrometry Data from Different Sources > Workshop goals and objectives","what":"Learning objectives","title":"Mass Spectrometry Data Analysis with Spectra","text":"Import export MS data Spectra. Integrate MS data different resources MS data analysis workflow. Apply different data manipulations MS data represented Spectra object. Use Spectra perform spectra comparisons R.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"pre-requisites","dir":"","previous_headings":"Seamless Integration of Mass Spectrometry Data from Different Sources","what":"Pre-requisites","title":"Mass Spectrometry Data Analysis with Spectra","text":"Basic familiarity R Bioconductor. Basic understanding Mass Spectrometry (MS) data.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"rbioconductor-packages-used","dir":"","previous_headings":"Seamless Integration of Mass Spectrometry Data from Different Sources","what":"R/Bioconductor packages used","title":"Mass Spectrometry Data Analysis with Spectra","text":"Spectra MsCoreUtils MsBackendMgf MsBackendMassbank CompoundDb","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"spectra-an-expandable-infrastructure-to-handle-mass-spectrometry-data","dir":"","previous_headings":"","what":"Spectra: an expandable infrastructure to handle mass spectrometry data","title":"Mass Spectrometry Data Analysis with Spectra","text":"rendered version","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"short-description-1","dir":"","previous_headings":"Spectra: an expandable infrastructure to handle mass spectrometry data","what":"Short description","title":"Mass Spectrometry Data Analysis with Spectra","text":"Explain different representations mass spectrometry data along properties advantages. Explain caching lazy processing queue Spectra package.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"description-1","dir":"","previous_headings":"Spectra: an expandable infrastructure to handle mass spectrometry data","what":"Description","title":"Mass Spectrometry Data Analysis with Spectra","text":"Spectra package provides modern infrastructure MS data handling specifically designed enable extension additional data resources alternative data representations. can realized extending virtual MsBackend class related methods. Implementations MsBackend classes can tailored specific needs, low memory footprint, fast processing, remote data access, also support specific additional data types variables. Importantly, data processing Spectra objects independent backend use due lazy evaluation mechanism caches data manipulations internally. workshop discusses different available data representations MS data along properties, advantages performances. addition, Spectra’s concept lazy evaluation data manipulations presented, well simple caching mechanism data modifications. Finally, explains new MsBackend instances can implemented tested ensure compliance.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"pre-requisites-1","dir":"","previous_headings":"Spectra: an expandable infrastructure to handle mass spectrometry data","what":"Pre-requisites","title":"Mass Spectrometry Data Analysis with Spectra","text":"Basic familiarity R Bioconductor. Basic understanding Mass Spectrometry (MS) data.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"rbioconductor-packages-used-1","dir":"","previous_headings":"Spectra: an expandable infrastructure to handle mass spectrometry data","what":"R/Bioconductor packages used","title":"Mass Spectrometry Data Analysis with Spectra","text":"Spectra MsBackendSql","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"workshop-goals-and-objectives-1","dir":"","previous_headings":"Spectra: an expandable infrastructure to handle mass spectrometry data","what":"Workshop goals and objectives","title":"Mass Spectrometry Data Analysis with Spectra","text":"technical demonstration internals Spectra package design MS infrastructure. ’re demonstrating use cases analysis workflows .","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"learning-goals-1","dir":"","previous_headings":"Spectra: an expandable infrastructure to handle mass spectrometry data > Workshop goals and objectives","what":"Learning goals","title":"Mass Spectrometry Data Analysis with Spectra","text":"Understand MS data handled Spectra. Understand differences properties different MsBackend implementations.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"learning-objectives-1","dir":"","previous_headings":"Spectra: an expandable infrastructure to handle mass spectrometry data > Workshop goals and objectives","what":"Learning objectives","title":"Mass Spectrometry Data Analysis with Spectra","text":"Learn MS data handled Spectra. Understand data representations/backends fit purpose/use case. Insights internals Spectra MS infrastructure facilitate implementation backend(s).","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/index.html","id":"msms-spectra-matching-with-the-metaboannotation-package","dir":"","previous_headings":"","what":"MS/MS Spectra Matching with the MetaboAnnotation Package","title":"Mass Spectrometry Data Analysis with Spectra","text":"rendered version Spectra package provides functionality required annotation identification workflows untargeted LC-MS/MS data, , flexible customizable, might cumbersome beginners analysts accustomed R. fill gap developed MetaboAnnotation package builds upon Spectra provides functions annotation LC-MS LC-MS/MS data sets tailored towards less experienced R user. tutorial shows MetaboAnnotation can used R-based LC-MS/MS annotation workflows. Note also additional tutorial MetaboAnnotation, CompoundDb MetaboCoreUtils packages available: MetaboAnnotationTutorials.","code":""},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-8","dir":"Changelog","previous_headings":"","what":"Version 0.8.0","title":"Version 0.8","text":"Add new tutorial Spectra: expandable infrastructure handle mass spectrometry data. Download MassBank data alternative AnnotationHub.","code":""},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-7","dir":"Changelog","previous_headings":"","what":"Version 0.7.3","title":"Version 0.7","text":"Fix mislabeling columns experimental spectra rows MassBank spectra spectra similarity matrix (thanks CSAMA2023 attendee pointing !).","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-7-1","dir":"Changelog","previous_headings":"","what":"Version 0.7.2","title":"Version 0.7","text":"Use MsBackendSql instead MsqlBackend.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-7-2","dir":"Changelog","previous_headings":"","what":"Version 0.7.1","title":"Version 0.7","text":"Simplify/clarify description spectra data processing.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-7-3","dir":"Changelog","previous_headings":"","what":"Version 0.7.0","title":"Version 0.7","text":"Add section use MsqlBackend compare performance MsBackendMzR MsBackendDataFrame.","code":""},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-6","dir":"Changelog","previous_headings":"","what":"Version 0.6.3","title":"Version 0.6","text":"Better describe usage alternative SQLite MassBank database file two workshops.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-6-1","dir":"Changelog","previous_headings":"","what":"Version 0.6.2","title":"Version 0.6","text":"Add citation.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-6-2","dir":"Changelog","previous_headings":"","what":"Version 0.6.1","title":"Version 0.6","text":"Adapt changes Spectra >= 1.5.8: export spectraVariableMapping method. Adapt changes CompoundDb >= 0.9.6: \"target_name\" available spectra variable Spectra objects returned CompDb database. Adapt changes MetaboAnnotation >= 0.99.4: also ppm error reported matchMz.","code":""},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-6-3","dir":"Changelog","previous_headings":"","what":"Version 0.6.0","title":"Version 0.6","text":"Remove Spectra object data HMDB. Use CompDb database HMDB annotations.","code":""},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-5","dir":"Changelog","previous_headings":"","what":"Version 0.5.0","title":"Version 0.5","text":"Add additional vignette describing spectra matching MetaboAnnotation package integration xcms analysis workflow.","code":""},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-4","dir":"Changelog","previous_headings":"","what":"Version 0.4.0","title":"Version 0.4","text":"Version used BioC2021 conference. Use MassBank release 2021.03. Restructure document simplify analysis (reduce mzML files 20eV collision energy).","code":""},{"path":[]},{"path":"https://jorainer.github.io/SpectraTutorials/news/index.html","id":"version-0-3","dir":"Changelog","previous_headings":"","what":"Version 0.3.2","title":"Version 0.3","text":"Use MassBank release 2021.02 add expand descriptive text.","code":""}]
